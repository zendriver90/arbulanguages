const fiszki = [
{
id: [
        1,
        1,
        1
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkihung/1a.jpg"
        ],
        translate: "Minden, amit tehetünk, az a választás",
        translateb: "[Ol wat wi kan du is csiuz]",
        srcWord: ["http://localhost/arbulanguage.com/filmy/hung/choice.mp4", 'Matrix (1999)'],
        srcWordimage: "http://localhost/arbulanguage.com/filmy/hung/choice.png",
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "<u><b>Minden</u></b> no <u><b>ol</u></b>vassa ext a konyvet"
        ],
        // opis
        desc: "all[ol] - minden",
        //zdanie
        sentence1: [
                "All"
        ],
        sentence: [
                "All",
                "what",
                "we",
                "can do"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"],
        category3: ["Infinitive"]
},
{
id: [
        2,
        1,
        1
],
        // obrazek
        img: [
            "https://www.arbulang.com/img/fiszkihung/2a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "A <u><b>W</u></b>almart a kedvenc boltom. Nézzétek meg, <u><b>mit</u></b> lehet ott venni: c<u><b>it</u></b>romot és h<u><b>am</u></b>ot"
        ],
        // opis
        desc: "what[wat] - amit",
        //zdanie
        sentence1: [
                "what"
        ],
        sentence: [
                "All",
                "what",
                "we",
                "can do"
        ],
        //  slowo do nauki
        key: "everybody",
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        3,
        1,
        1
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkihung/3a.jpg"
        ],
        word: [
                "http://localhost/arbulanguage.com/voice/music.mp4"
        ],
        // historia
        story: [
                "Mi most <u><b>tehetünk</u></b> valami jót a <u><b>kan</u></b> kutyákért a menhelyünkön, egy kutya <u><b>du</u></b>rva"
        ],
        // opis
        desc: "(we)can do[kan du] - tehetünk",
        //zdanie
        sentence2: [
                "(we) can do"
        ],
        sentence: [
                "All",
                "what",
                "we",
                "can",
                "do"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        4,
        1,
        2
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkihung/4a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "Az <u><b>is</u></b>kolank nagyon magasan <u><b>van</u></b> a rangsorban"
        ],
        // opis
        desc: "is[is] - van",
        //zdanie
        sentence2: [
                "is"
        ],
        sentence: [
                "is",
                "choose"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"],
                category3: ["Infinitive"]
},
{
id: [
        5,
        1,
        2
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/5a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "A <u><b>cs</u></b>eresznye csucsan vagyok(C<u><b>iuz</u></b>i), nagy huzat van, de a legjobb csereszznyeket <u><b>valasztom</u></b>"
        ],
        // opis
        desc: "choose[csiuz] - valaszt",
        //zdanie
        sentence2: [
                "choose"
        ],
        sentence: [
                "is",
                "choose"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        6,
        2,
        3
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/6a.jpg"
        ],
                translate: "A hajó többnyire halászatra van",
        translateb: "[De b-auto is mo-ulsz-tle for fising]",
        srcWord: ["http://localhost/arbulanguage.com/filmy/hung/boat.mp4", 'Titanic (1997)'],
        srcWordimage: "http://localhost/arbulanguage.com/filmy/hung/boat.png",
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "Az <u><b>auto</u></b>palyan megyek, de ugy erzem, mintha egy <u><b>hajoban</u></b> lennek, es az auto a<u><b>b</u></b>lakabol csodalatos a kilatas"
        ],
        // opis
        desc: "(the) boat[bauto] - hajoban",
        //zdanie
        sentence2: [
                "The boat"
        ],
        sentence: [
                "The boat",
                "is",
                "mostly"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        7,
        2,
        3
],
        // obrazek
        img: [
                "https://www.arbulang.com/fiszkiespanol/4a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "Az <u><b>is</u></b>kolank nagyon magasan <u><b>van</u></b> a rangsorban"
        ],
        // opis
        desc: "is[is] - van",
        //zdanie
        sentence2: [
                "is"
        ],
        sentence: [
                "The boat",
                "is",
                "mostly"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        8,
        2,
        3
],
        // obrazek
        img: [
                "https://www.arbulang.com/fiszkiespanol/8a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "<u><b>Tobbnyire</u></b> nyugodtan <u><b>ulsz</u></b> es <u><b>mo</u></b>solyogsz, igy vanzo vagy? Igen, mert a<u><b>tle</u></b>tikazom is"
        ],
        // opis
        desc: "mostly[mo-ulsz-tle] - ",
        //zdanie
        sentence2: [
                "mostly"
        ],
        sentence: [
                "The boat",
                "is",
                "mostly"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        9,
        2,
        4
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/9a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "A gyerek játszik a homo<u><b>koz</u></b>óban, <u><b>mert</u></b> ez a kedvenc szórakozása <u><b>for</u></b>rása"
        ],
        // opis
        desc: "for(couse)[for] - mert",
        //zdanie
        sentence2: [
                "for"
        ],
        sentence: [
                "for",
                "fishing"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"],
                category3: ["Infinitive"]
},
{
id: [
        10,
        2,
        4
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/10a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "A <u><b>fis</u></b>kális nyugta az <u><b>ing</u></b>atlanról jó szokás, aztán pedig a <u><b>horgászat</u></b>"
        ],
        // opis
        desc: "fishing[fising] - halászat",
        //zdanie
        sentence2: [
                "fishing"
        ],
        sentence: [
                "for",
                "fishing"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        11,
        3,
        5
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/11a.jpg"
        ],
                        translate: "Ellenőrizd a tojást, mielőtt megfőzöd",
        translateb: "[Csek de egg bifur kuk it]",
        srcWord: ["http://localhost/arbulanguage.com/filmy/hung/morning.mp4", 'Fast and Furious: Hobbs and Shaw (2019)'],
        srcWordimage: "http://localhost/arbulanguage.com/filmy/hung/morning.png",
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "Amikor <u><b>ellenoriztem</u></b> a bankszamlamat, megfajdult az <u><b>ek</u></b>etem. Eszek egy kis <u><b>cs</u></b>okoladet"
        ],
        // opis
        desc: "check[] - ellenoriz",
        //zdanie
        sentence1: [
                "Check"
        ],
        sentence: [
                "Check",
                "the egg"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        12,
        3,
        5
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/12a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "R<u><b>egg</u></b>elire tojast eszem nagyon <u><b>eg</u></b>yszeru reggeli"
        ],
        // opis
        desc: "(the) egg[] - tojast",
        //zdanie
        sentence1: [
                "the egg"
        ],
        sentence: [
                "Check",
                "the egg"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        13,
        3,
        6
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/13a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "<u><b>Mielőtt</u></b> lesz az ünnepség, <u><b>bifur</u></b>kálom a porciókat a vendégeknek"
        ],
        // opis
        desc: "before[bifur] - mielőtt",
        //zdanie
        sentence2: [
                "before"
        ],
        sentence: [
                "before",
                "you cook it"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
},
{
id: [
        14,
        3,
        6
],
        // obrazek
        img: [
                "https://www.arbulang.com/img/fiszkiespanol/14a.jpg"
        ],
        word: [
                "https://www.arbulang.com/voice/music.mp4"
        ],
        // historia
        story: [
                "<u><b>Megfőzöd</u></b> a különleges <u><b>kuk</u></b>oricás édességet az ünnepségre, és cuk<u><b>it</u></b> is hozok hozzá"
        ],
        // opis
        desc: "(you) cook it[kuk it] - megfőzöd",
        //zdanie
        sentence2: [
                "(you) cook it"
        ],
        sentence: [
                "before",
                "you cook it"
        ],
        //  slowo do nauki
        key: "everybody",
        category1: [
        ],
        category2: ["osoby", "osoby+czas"]
}
];

function addToTrainingList(idFiszki) {
    // dodaj do local storage do treningu
    addFiszkaToLesson(idFiszki);
}
function activateFiszka(idFiszki, znam) {
    let id = idFiszki;
    let parametr = '';

    if (Array.isArray(idFiszki)) {
        // Połącz wartości z tablicy id w jeden ciąg znaków oddzielony przecinkami
        id = idFiszki.slice(0, 3).join(',');
        // Obsługa ewentualnego dodatkowego parametru (np. czwartego elementu w tablicy)
        parametr = idFiszki.length > 3 ? idFiszki[3] : '';
    }

    // Tworzenie klasy CSS z odpowiednim formatowaniem (poprawione usunięcie przecinków w CSS)
    const className = `fiszka-${id}${parametr ? '\\,' + parametr : ''}`;
    const selector = `.${className.replace(/,/g, '\\,')}`;
    console.log(selector);

    if (znam) {
        // Zapisz klasę 'active' lub zmień z 'active2' na 'active'
        if ($(selector).hasClass('active2')) {
            $(selector).removeClass('active2').addClass('active');
            updateLearnedClass(className, 'active');
        } else {
            $(selector).addClass('active');
            saveLearnedClass(className, 'active');
        }
        setAsLearned(id);
        console.log(`Set fiszka with ID ${id} as learned.`);
    } else {
        // Zapisz klasę 'active2' lub usuń 'active'
        $(selector).removeClass('active').addClass('active2');
        saveLearnedClass(className, 'active2');
        addToTrainingList(id);
        console.log(`Clicked - fiszka with ID ${id} added to training list.`);
        console.log('Clicked', $(selector));
    }
}



// Funkcja do zapisywania klasy w Local Storage
function saveLearnedClass(className, classToAdd) {
    let learnedClasses = getLearned2();
    const existingEntryIndex = learnedClasses.findIndex(entry => entry.className === className);

    if (existingEntryIndex !== -1) {
        // Jeśli już istnieje, zaktualizuj klasę
        learnedClasses[existingEntryIndex].classToAdd = classToAdd;
    } else {
        // W przeciwnym razie dodaj nowy wpis
        learnedClasses.push({className, classToAdd});
    }

    localStorage.setItem('ColorClass', JSON.stringify(learnedClasses));
    console.log('ColorClass', learnedClasses);
}

// Funkcja do aktualizacji klasy 'active' w Local  Storage
function updateLearnedClass(className, classToUpdate) {
    let learnedClasses = getLearned2();
    const existingEntryIndex = learnedClasses.findIndex(entry => entry.className === className);

    if (existingEntryIndex !== -1) {
        // Jeśli już istnieje, zaktualizuj klasę
        learnedClasses[existingEntryIndex].classToAdd = classToUpdate;
        localStorage.setItem('ColorClass', JSON.stringify(learnedClasses));
        console.log('ColorClass', learnedClasses);
    }
}

// Funkcja do odzyskiwania klas z Local Storage
function getLearned2() {
    const storedColorClass = localStorage.getItem('ColorClass');
    return storedColorClass ? JSON.parse(storedColorClass) : [];
}

// Wywołanie klas po odświeżeniu strony
$(document).ready(function () {
    const learnedClasses = getLearned2();
    learnedClasses.forEach(function (entry) {
        $(`.${entry.className}`).addClass(entry.classToAdd);
    });
});
let lessons2b = {};

// Funkcja do zapisywania danych do localStorage
function saveToLocalStorage(data) {
    localStorage.setItem('wylosowaneLekcje', JSON.stringify(data));
}

// Funkcja do wczytywania danych z localStorage
function loadFromLocalStorage() {
    const storedData = localStorage.getItem('wylosowaneLekcje');
    return storedData ? JSON.parse(storedData) : null;
}

const storedLessons = loadFromLocalStorage();

if (storedLessons) {
    lessons2b = storedLessons;
    console.log('Wczytane dane z localStorage:', lessons2b);
    console.log('hejlekcje', lessons2b[2]);

    // Wywołanie funkcji showFiszki2 po wczytaniu danych
    setTimeout(() => {
        console.log('Wywołanie showFiszki2 z wczytanymi danymi');
        showFiszki2();  // Upewnij się, że ta funkcja jest zdefiniowana
    }, 0);
} else {
    // Jeśli nie ma zapisanych danych, losuj i zapisz
    for (let i = 1; i <= 30; i++) {
        lessons2b[i] = [];
    }

    // Zapisz dane do localStorage
    saveToLocalStorage(lessons2b);

    // Wywołanie showFiszki2 po zapisaniu nowych danych
    setTimeout(() => {
        console.log('Wywołanie showFiszki2 z nowo wygenerowanymi danymi');
        showFiszki2();  // Upewnij się, że ta funkcja jest zdefiniowana
    }, 0);
}


// Sprawdzanie zawartości lessons2b po załadowaniu danych
function printLessons2b() {
    console.log('hej555', lessons2b[2]);
}

// Wywołaj tę funkcję, gdy masz pewność, że dane zostały załadowane
document.addEventListener('DOMContentLoaded', function () {
    setTimeout(printLessons2b, 1000);  // Opóźnienie dla pewności
});

function generateFiszkaBlock(fiszka, lessonId2) {
    console.log('hej555c', lessons2b[2]);
    var currentStoryButtonName = ''; // Zmienna lokalna
    console.log(`Generating fiszka block for ID: [${fiszka.id.join(', ')}]`);

    // Tworzenie kontenera fiszki

    $(document).ready(function () {

        function initAudio(fiszkaId) {
            var audioId = 'music' + fiszkaId;
            var pButtonId = 'pButton' + fiszkaId;

            var music = document.getElementById(audioId);
            var pButton = document.getElementById(pButtonId);
            // Dodajemy style bezpośrednio w kodzie JavaScript
            if (window.matchMedia("(max-width: 999px)").matches) {
                pButton.style.height = '100px';  // Zwiększenie wysokości
                pButton.style.width = '100px';   // Zwiększenie szerokości
            } else {
                pButton.style.height = '60px';  // Zwiększenie wysokości
                pButton.style.width = '60px';   // Zwiększenie szerokości
            }
            pButton.style.border = 'none';   // Usunięcie ramki
            pButton.style.backgroundSize = '80%';  // Rozmiar obrazka tła
            pButton.style.backgroundRepeat = 'no-repeat';
            pButton.style.backgroundPosition = 'center';
            pButton.style.borderRadius = '8px';   // Zaokrąglenie rogów
            pButton.style.outline = 'none';       // Usunięcie obramowania
            pButton.style.display = 'flex';       // Wyśrodkowanie zawartości
            pButton.style.alignItems = 'center';
            pButton.style.justifyContent = 'center';
            pButton.style.overflow = 'hidden';    // Ukrycie nadmiarowego kontentu
            console.log('Initialized audio element with ID:', audioId);
            console.log('Initialized play/pause button with ID:', pButtonId);

            // Play and Pause
            function playb() {
                // start music
                if (music.paused) {
                    music.play();
                    // remove play, add pause
                    pButton.classList.remove("play");
                    pButton.classList.add("pause");
                } else { // pause music
                    music.pause();
                    // remove pause, add play
                    pButton.classList.remove("pause");
                    pButton.classList.add("play");
                }
                console.log('Audio playback status:', music.paused ? 'Paused' : 'Playing');
            }

            // Gets audio file duration
            music.addEventListener("canplaythrough", function () {
                var duration = music.duration;
                console.log('Audio duration:', duration);
            }, false);

            // Dodajemy event listener do przycisku play/pause
            pButton.addEventListener('click', playb);

            console.log('Audio initialization completed.');
        }

// TWORZENIE KONTENERA FISZKI
        let fiszkaContainer = $('<div>').addClass('fiszka fiszka-' + fiszka.id);



        // DODANIE OBRAZKA
        const imgContainer = $('<div>').addClass('fiszka_img_container');
        if (Array.isArray(fiszka.img) && fiszka.img.length > 0) {
            fiszka.img.forEach((imgSrc, index) => {
                const imgElement = $('<img class="fiszka_img">').attr('src', imgSrc);
                imgContainer.append(imgElement);
                if (index > 0) {
                    imgElement.hide();
                }
            });
        } else if (typeof fiszka.img === 'string') {
            // Jeśli jest tylko jedno zdjęcie, dodajemy je do imgContainer dla każdej fiszki
            const imgElement = $('<img class="fiszka_img">').attr('src', fiszka.img);
            imgContainer.append(imgElement);
        }
        fiszkaContainer.append(imgContainer); //DODANIE OBRAZKA

        const selectedLikes = [];
        console.log('hej10', selectedLikes);

// Funkcja do obsługi kliknięcia na przycisk "likeButton"
        function handleLikeButtonClick(index) {
            const likeButton = $(this);
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            const selectedLike = likeButton.text();
            console.log('Zaktualizowano przycisk dla indeksu:', index);
            console.log('Aktualne wartości selectedLikes:', selectedLikes);
        }
        const likeButton = $('<a>').addClass('like').attr('href', '#');
        const likeText = $('<span>').text('Śmieszna historia');
        likeButton.append(likeText);
        fiszkaContainer.append(likeButton);

        // Tworzymy kontener opcji "like" i dodajemy opcje do kontenera
        const likeOptionsContainer = $('<div>').attr('id', 'likeOptionsContainer');
        const likeOption1 = createLikeOption('thumbsUp', '👍 Śmieszne');
        const likeOption2 = createLikeOption('heart', '❤️ Miłe');
        const likeOption3 = createLikeOption('star', '⭐ Pamiętliwe');
        likeOptionsContainer.append(likeOption1, likeOption2, likeOption3);

        // Dodajemy kontener opcji "like" do docelowego kontenera
        likeButton.append(likeOptionsContainer);

        // Ukrywamy kontener opcji "like"
        likeOptionsContainer.hide();

        // Obsługa zdarzenia hover na przycisku "like"
        likeButton.hover(function () {
            const buttonPosition = likeButton.offset();
            const buttonWidth = likeButton.outerWidth();

            // Pozycjonujemy kontener opcji "like" nad przyciskiem
            likeOptionsContainer.css({
                top: buttonPosition.top - likeOptionsContainer.outerHeight() - 10,
                left: buttonPosition.left + (buttonWidth / 2) - (likeOptionsContainer.outerWidth() / 2),
                backgroundColor: '#f0f0f0', // Dodajemy szary kolor tła
            }).fadeIn('fast');
        }, function () {
            // Ukrywamy kontener opcji "like" po zjechaniu z przycisku
            likeOptionsContainer.fadeOut('fast');
        });

// Funkcja do umieszczania ikony obok przycisku "story_button" w odpowiedniej fiszce
        function addLikeIconToStoryButton(index, like) {
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            if (storyButton.length === 0) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            // Tworzymy kontener dla ikony i dodajemy ikonę
            const iconContainer = $('<div>').addClass('likeIconContainer');
            const likeIcon = getLikeIcon(like);
            iconContainer.append(likeIcon);

            // Usuwamy wcześniej dodaną ikonę, jeśli istnieje
            storyButton.find('.likeIconContainer').remove();

            // Dodajemy kontener z ikoną do przycisku "story_button"
            storyButton.append(iconContainer);
        }

        function createLikeOption(like, text) {
            const likeOption = $('<div>').addClass('likeOption').attr('data-like', like).text(text);

            // Dodajemy efekt zmiany koloru na lekko ciemniejszy szary po najechaniu myszką na pojedynczą opcję "like"
            likeOption.hover(
                    function () {
                        likeOption.css('background-color', '#dcdcdc'); // Lekko ciemniejszy szary kolor tła dla opcji "like"
                    },
                    function () {
                        likeOption.css('background-color', ''); // Usuwamy styl, aby wrócić do domyślnego tła opcji "like"
                    }
            );

            let likeCounter = 0; // Dodajemy licznik polubień dla każdej opcji "like"

            const counterDiv = $('<div>').addClass('likeCounterDiv'); // Nowy div na licznik

            // Dodajemy ikonę do licznika
            const likeIcon = getLikeIcon(like);
            const iconContainer = $('<span>').addClass('likeIconContainer').append(likeIcon);
            counterDiv.append(iconContainer);

            const likeCounterSpan = $('<span>').addClass('likeCounter').text(` ${likeCounter} `);
            counterDiv.append(likeCounterSpan); // Licznik jest dodany po ikonie

            imgContainer.append(counterDiv); // Dodajemy licznik na zewnątrz kontenera przycisków

            likeOption.click(function (event) {
                event.preventDefault(); // Zapobiegamy domyślnej akcji przycisku

                // Inkrementujemy licznik polubień za każdym razem, gdy opcja "like" zostanie wybrana
                likeCounter++;
                likeCounterSpan.text(` ${likeCounter} `);

                const selectedLike = $(this).data('like');
                const selectedIcon = getLikeIcon(selectedLike);
                likeText.text(text);
                likeButton.removeClass('liked');
                addLikeIconToStoryButton(lastClickedIndex, selectedLike); // Dodaj ikonę do story_button na podstawie wybranej opcji "like"

                // Sprawdź, czy index już istnieje w tablicy
                const existingIndex = selectedLikes.findIndex(item => item.index === lastClickedIndex);
                if (existingIndex !== -1) {
                    // Jeśli index istnieje, zaktualizuj wartość
                    selectedLikes[existingIndex].like = selectedLike;
                } else {
                    // Jeśli index nie istnieje, dodaj nowy wpis
                    selectedLikes.push({index: lastClickedIndex, like: text}); // Dodaj tylko nazwę "like"
                }

                likeOptionsContainer.fadeOut('fast');
                saveSelectedLike(selectedLike, text); // Przekazujemy nazwę "like" i tekst do funkcji saveSelectedLike
            });

            return likeOption;
        }

// Funkcja do zapisywania wybranego "like"
        function saveSelectedLike(selectedLike, text) {
            // Tutaj możesz zapisać wybrany "like" w odpowiednim kontekście, np. wysłać go na serwer, zapisać w lokalnym magazynie itp.
            console.log('Wybrany like:', text);
            console.log('Tekst:', text);
            // Jeśli chcesz użyć go w innych miejscach, możesz przekazać go jako argument do innych funkcji lub zmiennych.
        }

        // Funkcja do pobierania ikony dla wybranego "like"
        function getLikeIcon(like) {
            let icon;
            switch (like) {
                case 'thumbsUp':
                    icon = $('<span class="likeIcon">👍</span>');
                    break;
                case 'heart':
                    icon = $('<span class="likeIcon">❤️</span>');
                    break;
                case 'star':
                    icon = $('<span class="likeIcon">⭐</span>');
                    break;
                default:
                    icon = $('<span class="likeIcon">👍</span>');
            }
            return icon;
        }

        const hashtagContainer = $('<a>').addClass('hashtag-container').attr('href', '#');
        fiszkaContainer.append(hashtagContainer);

        function showStory(index) {
            const currentFiszka = fiszkaContainer;

            // Ukrywamy wszystkie historie w tej konkretnej fiszce
            currentFiszka.find('.fiszka_story').hide();

            // Obsługa mnemoniki
            if (Array.isArray(fiszka.story)) {
                if (index >= 0 && index < fiszka.story.length) {
                    currentFiszka.find('.story-' + index).show();
                }
            } else if (fiszka.story) {
                currentFiszka.find('.story-0').show();
            }

            // Ukrywamy wszystkie obrazy
            currentFiszka.find('.fiszka_img').hide();

            // Obsługa obrazów
            let imgIndex; // Zmienna do przechowywania indeksu obrazka

            if (Array.isArray(fiszka.img)) {
                imgIndex = Math.min(index, fiszka.img.length - 1);
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img[imgIndex];
                console.log("Index obrazka:", imgIndex);
            } else {
                imgIndex = 0; // Ustawienie imgIndex na 0, gdy fiszka.img nie jest tablicą
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img;
                console.log("Index obrazka:", imgIndex);
            }

            lastClickedIndex = index;

            // Obsługa hashtagów
            const selectedCategoryIndex = index * 2;
            const value = fiszka.category1[selectedCategoryIndex];
            const hashtag = fiszka.category1[selectedCategoryIndex + 1];

            hashtagContainer.empty();
            hashtagContainer.text(`${value} #${hashtag}`);

            console.log('Calculated imgIndex:', imgIndex);

            return imgIndex;
        }

        function selectLikeButton(index) {
            console.log("Wybór likeButton dla indeksu:", index);
            const storyButton = $('.story_button').eq(index);
            if (!storyButton.length) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            const likeButton = storyButton.find('.like');
            likeText.find('span').remove();
            likeText.text('Śmieszna historia');

            // Sprawdź, czy index jest zawarty w tablicy selectedLikes
            const selectedLike = selectedLikes.find(item => item.index === index);
            if (selectedLike) {
                // Jeśli index istnieje w tablicy, ustaw ikonę przycisku na wartość z tablicy
                console.log("Wybrano like dla indeksu:", index, "- Like:", selectedLike.like);
                const selectedIcon = getLikeIcon(selectedLike.like); // Przekazujemy tylko nazwę ikony
                console.log('hej5', selectedIcon);
                likeText.html(selectedLike.like); // Ustawiamy ikonę
            } else {
                // Jeśli index nie istnieje, ustaw domyślny tekst
                console.log("Brak wyboru like dla indeksu:", index, "- Ustawianie domyślnego tekstu");
                likeButton.text('Śmieszna historia');
            }
        }
        // NIEZNACZĄCE WYJAŚNIENIE SŁOWA
        const sentenceDiv = $('<div>').attr('id', 'part');
        fiszka.sentence.forEach(word => {
            sentenceDiv.append($('<button>').text(word));
        });
        // Dodanie diva z przyciskami do kontenera fiszki
        fiszkaContainer.append(sentenceDiv);

        console.log('Przed utworzeniem wordDiv');
        const wordDiv = $('<div>').attr('id', 'word');
        const button = $('<button>').attr('id', 'storyone').html('<b>' + fiszka.desc + '</b>');
        const audio = $('<audio>').attr({
            id: 'music' + fiszka.id,
            preload: 'true'
        });
        const source = $('<source>').attr('src', fiszka.word);
        audio.append(source);
        const audioplayerDiv = $('<div>').attr('id', 'audioplayer' + fiszka.id).addClass('audioplayer'); // Dodano klasę 'audioplayer'
        const pButton = $('<button>').attr('id', 'pButton' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

        pButton.css({
            height: '60px',
            width: '60px',
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            float: 'left',
            outline: 'none',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden'
        });

        audioplayerDiv.append(pButton);
        wordDiv.append(button);
        wordDiv.append(audio);
        wordDiv.append(audioplayerDiv);
        fiszkaContainer.append(wordDiv);
        console.log('Po utworzeniu wordDiv');

// DODANIE MNEMOTECHNIKI
        if (Array.isArray(fiszka.story)) {
            // Jeśli story jest tablicą, iterujemy przez wszystkie jej elementy
            fiszka.story.forEach((story, index) => {
                const storyContainer = $('<div>').addClass('fiszka_story story-' + index).html(story);
                fiszkaContainer.append(storyContainer);
                console.log("Dodano story: ", story);  // Debugowanie
            });
        } else if (fiszka.story) {
            // Jeśli story jest pojedynczym stringiem, dodajemy go bezpośrednio
            const storyContainer = $('<div>').addClass('fiszka_story story-0').html(fiszka.story);
            fiszkaContainer.append(storyContainer);
            console.log("Dodano story: ", fiszka.story);  // Debugowanie
        }
        console.log('Przed utworzeniem wordDiv');

// Utworzenie reszty elementów zgodnie z istniejącym kodem
        const wordDiv2 = $('<div>').attr('id', 'word2');
        const audio2 = $('<audio>').attr({
            id: 'music2' + fiszka.id,
            preload: 'true'
        });
        const source2 = $('<source>').attr('src', fiszka.word);
        audio2.append(source2);
        const audioplayerDiv2 = $('<div>').attr('id', 'audioplayer2' + fiszka.id).addClass('audioplayer2'); // Dodano klasę 'audioplayer'
        const pButton2 = $('<button>').attr('id', 'pButton2' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

// Utworzenie elementów za pomocą jQuery
        const timelineDiv = $('<div>').attr('id', 'timeline' + fiszka.id);
        const playheadDiv = $('<div>').attr('id', 'playhead' + fiszka.id);

// Dodanie playhead do timeline
        timelineDiv.append(playheadDiv);

// Dodanie elementów do odpowiednich kontenerów
        audioplayerDiv.append(pButton2);
        wordDiv2.append(audio2);
        wordDiv2.append(audioplayerDiv2);
        wordDiv2.append(timelineDiv); // Dodano timeline do wordDiv
        fiszkaContainer.append(wordDiv2);

        console.log('Po utworzeniu wordDiv');
        // Zdefiniuj zmienną początkową na poziomie wyższym
        let initialSpecificLesson2Ref;
        let specificLesson2Ref;
        let lastClickedIndex = null;
        let lastApprovedIndex = null; // Zmienna do przechowywania ostatnio zatwierdzonego indeksu
        let approvedIndexes = []; // Tablica przechowująca zatwierdzone indeksy
        let approvedColors = [];

// DODANIE PRZYCISKÓW
        if (Array.isArray(fiszka.category1)) {
            const storyButtonContainer = $('<div>'); // Kontener na przyciski
            const randomIndex = Math.floor(Math.random() * fiszka.category1.length / 2);
            let lastClickedButton; // Zmienna do przechowywania ostatnio klikniętego przycisku w danej fiszce

            fiszka.category1.slice(0, 5).forEach((category1, index) => {
                const valueIndex = index * 2; // Indeks wartości w tablicy, zaczynając od 0
                const hashtagIndex = valueIndex + 1; // Indeks hashtagu w tablicy

                const value = fiszka.category1[valueIndex];
                const hashtag = fiszka.category1[hashtagIndex];

                const displayText = `${value} #${hashtag}`;

                const storyButton = $('<button>')
                        .text(displayText)
                        .addClass('story_button')
                        .click(function () {
                            showStory(index);
                            lastClickedIndex = index;

                            // Usuwamy zieloną klasę tylko z poprzedniego przycisku w danej fiszce
                            if (lastClickedButton) {
                                lastClickedButton.removeClass('green-button');
                            }

                            // Usuwamy klasę imgIndex z poprzedniego przycisku w danej fiszce
                            $('.story_button').removeClass((index, className) => (className.match(/imgIndex-\d+/g) || []).join(' '));
                            // Dodajemy klasę imgIndexNull do przycisków, które nie zostały jeszcze zatwierdzone
                            $('.fiszka').addClass('imgIndexNull').removeClass('imgIndex-0 imgIndex-1 imgIndex-2 imgIndex-3 imgIndex-4 ');

                            // Dodajemy zieloną klasę tylko dla aktualnie klikniętego przycisku w danej fiszce
                            $(this).addClass('green-button');
                            $('.story_button').removeClass('active-button');
                            $(this).addClass('active-button');
                            $('.story_button').each(function (index) {
                                if ($(this).hasClass('orange-button')) {
                                    $(this).removeClass('green-button');
                                    $(this).addClass('orange-button');
                                }
                            });

                            // Jeśli przycisk został wcześniej zatwierdzony, przywróć jego zatwierdzoną klasę
                            if (approvedIndexes.includes(lastClickedIndex)) {
                                fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
                            }

                            // Zapisujemy ostatnio kliknięty przycisk w danej fiszce
                            lastClickedButton = $(this);
                            handleLikeButtonClick();
                        });

                if (index === randomIndex) {
                    // Sprawdzamy, czy fiszka.img jest tablicą czy pojedynczą wartością
                    if (Array.isArray(fiszka.img)) {
                        newImgIndex = Math.min(index, fiszka.img.length - 1); // Aktualizacja zmiennej globalnej imgIndex
                        specificLesson2Ref = fiszka.img[newImgIndex];
                        console.log('hej432', specificLesson2Ref);
                    } else if (fiszka.img) {
                        newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
                        specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
                        console.log('hej432', specificLesson2Ref);
                    }
                    initialSpecificLesson2Ref = specificLesson2Ref;
                    console.log('Hej7', specificLesson2Ref);
                    storyButton.addClass('green-button');
                    lastClickedButton = storyButton;
                    lastApprovedIndex = index; // Ustaw ostatnio zatwierdzony indeks na indeks losowego przycisku
                }

                // Dodaj typ "like" dla tej fiszki do tablicy
                storyButtonContainer.append(storyButton);
            });

            fiszkaContainer.append(storyButtonContainer);

            // WYWOŁANIE TABLICY
            showStory(randomIndex);
            console.log(randomIndex);

            // Użycie specificLesson2Ref po załadowaniu strony
            console.log("Początkowy specificLesson2Ref:", initialSpecificLesson2Ref);

        } else if (fiszka.category1) {
            // Jeśli fiszka.category1 nie jest tablicą
            newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
            specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
            initialSpecificLesson2Ref = specificLesson2Ref;
            console.log('Hej7', specificLesson2Ref);

            // Stwórz pojedynczy przycisk dla pojedynczej wartości category1
            const displayText = `${fiszka.category1} #${fiszka.category1}`;
            const storyButton = $('<button>')
                    .text(displayText)
                    .addClass('story_button2 green-button') // Od razu przypisz zieloną klasę
                    .click(function () {
                        showStory(0); // Przekazujemy 0 jako indeks, ponieważ jest to pojedyncza wartość
                        lastClickedIndex = 0;

                        // Zapisujemy ostatnio kliknięty przycisk
                        lastClickedButton = $(this);
                        handleLikeButtonClick();
                    });

            fiszkaContainer.append(storyButton);
            lastClickedButton = storyButton;
            lastApprovedIndex = 0; // Ustaw ostatnio zatwierdzony indeks na 0

            // WYWOŁANIE POJEDYNCZEJ HISTORII
            showStory(0);
            console.log("Pojedyncza wartość dla category1, specificLesson2Ref:", specificLesson2Ref);
        }
        $('.fiszka_button_trening').click(function () {
            // Dodaj klasę pomarańczową tylko dla przycisku zatwierdzonego
            $('.story_button').each(function (index) {
                if ($(this).hasClass('green-button')) {
                    $(this).removeClass('green-button');
                    $(this).addClass('orange-button');
                }
            });
        });
        console.log('hej555ax', lessons2b[2]);
// DODANIE PRZYCISKU TRENING
        fiszkaContainer.append($('<button>').text('TRENING').addClass('fiszka_button fiszka_button_trening').click(function () {

            activateFiszka(fiszka.id, false);

            let id = fiszka.id;
            let parametr = '';

            // Sprawdzenie, czy idFiszki jest tablicą
            if (Array.isArray(fiszka.id)) {
                id = fiszka.id[0];         // Pierwszy element tablicy jako id
                parametr = fiszka.id[1] || ''; // Drugi element tablicy jako parametr, jeśli istnieje
            }

            // Tworzenie selektora na podstawie id i parametru
            const className = `fiszka-${id}\\,${parametr}`;
            const selector = `.${className}`;
            console.log('hej201', parametr);
            let first = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[0]) {
                first = true;
                console.log('hej200', first);

            }
            let second = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[1]) {
                second = true;
                console.log('hej200', second);

            }
            let third = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[2]) {
                third = true;
                console.log('hej200', third);

            }

            console.log("Trening clicked on fiszka nr " + fiszka.id);
            console.log("lessonId2:", lessonId2);
            console.log("nazwa", lessons2b[2]);
            // Wyswietlenie danej wartości img dla danej fiszka.id
            const specificLesson2 = specificLesson2Ref || initialSpecificLesson2Ref;
            console.log("img dla fiszki o id", fiszka.id, ":", specificLesson2);
            specificLesson2Ref = fiszka.img;
            // Znajdź indeks dla danej fiszki w tablicy lessons2[lessonId2]
            console.log('story55', specificLesson2Ref);
            // Używamy lastClickedIndex zamiast index
            imgIndex = showStory(lastClickedIndex); // Wywołanie funkcji showStory i zapisanie zwróconego indeksu obrazka
            console.log('działa', specificLesson2Ref);
            aktywujObrazek(first, second, third, specificLesson2, 'obrazek-container2b', true, fiszka, imgIndex); // Przekazanie imgIndex do funkcji aktywujObrazek
            // Dodajemy zatwierdzony indeks do tablicy
            approvedIndexes.push(lastClickedIndex);
            console.log(approvedIndexes);

            // Dodanie zatwierdzonej klasy imgIndex do fiszkaContainer po kliknięciu przycisku "TRENING"
            fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
        }));

        fiszkaContainer.append($('<button>').text('ZNAM').addClass('fiszka_button fiszka_button_znam').click(function () {
            console.log("Znam clicked on fiszka nr " + fiszka.id);
            activateFiszka(fiszka.id, true);
        }));

        // WYWOŁANIE HASHTAGU
        function updateButtonName(buttonName, fiszkaContainer) {
            // Usuń poprzednią nazwę, jeśli istnieje
            fiszkaContainer.find('.fiszka_button_name').remove();

            // Ustaw nazwę w prawym dolnym rogu fiszki
            const fiszkaButtonNameContainer = $('<div>').addClass('fiszka_button_name').text(buttonName);
            fiszkaContainer.append(fiszkaButtonNameContainer);
        }
        // Dodanie kontenera fiszki do body
        $('.grid-containerb').append(fiszkaContainer);
        console.log(`Generated fiszka block for ID: [${fiszka.id.join(', ')}]`);
        initAudio(fiszka.id);
    });
}
function generateFiszkaBlock2(fiszka, lessonId2) {
    console.log('hej555c', lessons2b[2]);
    var currentStoryButtonName = ''; // Zmienna lokalna
    console.log(`Generating fiszka block for ID: [${fiszka.id.join(', ')}]`);

    // Tworzenie kontenera fiszki

    $(document).ready(function () {

        function initAudio(fiszkaId) {
            var audioId = 'music' + fiszkaId;
            var pButtonId = 'pButton' + fiszkaId;

            var music = document.getElementById(audioId);
            var pButton = document.getElementById(pButtonId);
            // Dodajemy style bezpośrednio w kodzie JavaScript
            if (window.matchMedia("(max-width: 999px)").matches) {
                pButton.style.height = '100px';  // Zwiększenie wysokości
                pButton.style.width = '100px';   // Zwiększenie szerokości
            } else {
                pButton.style.height = '60px';  // Zwiększenie wysokości
                pButton.style.width = '60px';   // Zwiększenie szerokości
            }
            pButton.style.border = 'none';   // Usunięcie ramki
            pButton.style.backgroundSize = '80%';  // Rozmiar obrazka tła
            pButton.style.backgroundRepeat = 'no-repeat';
            pButton.style.backgroundPosition = 'center';
            pButton.style.borderRadius = '8px';   // Zaokrąglenie rogów
            pButton.style.outline = 'none';       // Usunięcie obramowania
            pButton.style.display = 'flex';       // Wyśrodkowanie zawartości
            pButton.style.alignItems = 'center';
            pButton.style.justifyContent = 'center';
            pButton.style.overflow = 'hidden';    // Ukrycie nadmiarowego kontentu
            console.log('Initialized audio element with ID:', audioId);
            console.log('Initialized play/pause button with ID:', pButtonId);

            // Play and Pause
            function playb() {
                // start music
                if (music.paused) {
                    music.play();
                    // remove play, add pause
                    pButton.classList.remove("play");
                    pButton.classList.add("pause");
                } else { // pause music
                    music.pause();
                    // remove pause, add play
                    pButton.classList.remove("pause");
                    pButton.classList.add("play");
                }
                console.log('Audio playback status:', music.paused ? 'Paused' : 'Playing');
            }

            // Gets audio file duration
            music.addEventListener("canplaythrough", function () {
                var duration = music.duration;
                console.log('Audio duration:', duration);
            }, false);

            // Dodajemy event listener do przycisku play/pause
            pButton.addEventListener('click', playb);

            console.log('Audio initialization completed.');
        }

// TWORZENIE KONTENERA FISZKI
        let fiszkaContainer = $('<div>').addClass('fiszka fiszka-' + fiszka.id);
    // Dodanie klasy parzysta, jeśli warunki są spełnione
    if (window.matchMedia("(max-width: 999px)").matches && lessonId2 % 2 === 0) {
        fiszkaContainer.addClass('parzysta');
    }
    // Tworzenie ikony krzyżyka
    let closeIcon = $('<span>')
        .addClass('close-icon')
    .html('&times;') // HTML kod krzyżyka
    .css({
        position: 'absolute',
        top: 'px', // Możesz dostosować pozycję
        right: '5px',
        width: '30px', // Szerokość kontenera
        height: '30px', // Wysokość kontenera (równa szerokości)
        cursor: 'pointer',
        color: 'red',
        fontSize: '40px', // Rozmiar fontu (zmniejszony dla lepszej czytelności)
        background: 'grey',
        border: '2px solid black',
        textAlign: 'center', // Wyrównanie tekstu w poziomie
        lineHeight: '30px', // Wyrównanie tekstu w pionie (równe wysokości kontenera)
        zIndex: 1000000
    });

    // Zdarzenie kliknięcia na krzyżyk
    closeIcon.on('click', function () {
        setTimeout(function () {
        removeFiszka(fiszka.id, lessonId2);
        }, 1000); // Opóźnienie w milisekundach (tu: 1 sekunda)
    });

    // Dodanie krzyżyka do fiszki
    fiszkaContainer.append(closeIcon);

        // DODANIE OBRAZKA
        const imgContainer = $('<div>').addClass('fiszka_img_container');
        if (Array.isArray(fiszka.img) && fiszka.img.length > 0) {
            fiszka.img.forEach((imgSrc, index) => {
                const imgElement = $('<img class="fiszka_img">').attr('src', imgSrc);
                imgContainer.append(imgElement);
                if (index > 0) {
                    imgElement.hide();
                }
            });
        } else if (typeof fiszka.img === 'string') {
            // Jeśli jest tylko jedno zdjęcie, dodajemy je do imgContainer dla każdej fiszki
            const imgElement = $('<img class="fiszka_img">').attr('src', fiszka.img);
            imgContainer.append(imgElement);
        }
        fiszkaContainer.append(imgContainer); //DODANIE OBRAZKA

        const selectedLikes = [];
        console.log('hej10', selectedLikes);

// Funkcja do obsługi kliknięcia na przycisk "likeButton"
        function handleLikeButtonClick(index) {
            const likeButton = $(this);
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            const selectedLike = likeButton.text();
            console.log('Zaktualizowano przycisk dla indeksu:', index);
            console.log('Aktualne wartości selectedLikes:', selectedLikes);
        }
        const likeButton = $('<a>').addClass('like').attr('href', '#');
        const likeText = $('<span>').text('Śmieszna historia');
        likeButton.append(likeText);
        fiszkaContainer.append(likeButton);

        // Tworzymy kontener opcji "like" i dodajemy opcje do kontenera
        const likeOptionsContainer = $('<div>').attr('id', 'likeOptionsContainer');
        const likeOption1 = createLikeOption('thumbsUp', '👍 Śmieszne');
        const likeOption2 = createLikeOption('heart', '❤️ Miłe');
        const likeOption3 = createLikeOption('star', '⭐ Pamiętliwe');
        likeOptionsContainer.append(likeOption1, likeOption2, likeOption3);

        // Dodajemy kontener opcji "like" do docelowego kontenera
        likeButton.append(likeOptionsContainer);

        // Ukrywamy kontener opcji "like"
        likeOptionsContainer.hide();

        // Obsługa zdarzenia hover na przycisku "like"
        likeButton.hover(function () {
            const buttonPosition = likeButton.offset();
            const buttonWidth = likeButton.outerWidth();

            // Pozycjonujemy kontener opcji "like" nad przyciskiem
            likeOptionsContainer.css({
                top: buttonPosition.top - likeOptionsContainer.outerHeight() - 10,
                left: buttonPosition.left + (buttonWidth / 2) - (likeOptionsContainer.outerWidth() / 2),
                backgroundColor: '#f0f0f0', // Dodajemy szary kolor tła
            }).fadeIn('fast');
        }, function () {
            // Ukrywamy kontener opcji "like" po zjechaniu z przycisku
            likeOptionsContainer.fadeOut('fast');
        });

// Funkcja do umieszczania ikony obok przycisku "story_button" w odpowiedniej fiszce
        function addLikeIconToStoryButton(index, like) {
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            if (storyButton.length === 0) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            // Tworzymy kontener dla ikony i dodajemy ikonę
            const iconContainer = $('<div>').addClass('likeIconContainer');
            const likeIcon = getLikeIcon(like);
            iconContainer.append(likeIcon);

            // Usuwamy wcześniej dodaną ikonę, jeśli istnieje
            storyButton.find('.likeIconContainer').remove();

            // Dodajemy kontener z ikoną do przycisku "story_button"
            storyButton.append(iconContainer);
        }

        function createLikeOption(like, text) {
            const likeOption = $('<div>').addClass('likeOption').attr('data-like', like).text(text);

            // Dodajemy efekt zmiany koloru na lekko ciemniejszy szary po najechaniu myszką na pojedynczą opcję "like"
            likeOption.hover(
                    function () {
                        likeOption.css('background-color', '#dcdcdc'); // Lekko ciemniejszy szary kolor tła dla opcji "like"
                    },
                    function () {
                        likeOption.css('background-color', ''); // Usuwamy styl, aby wrócić do domyślnego tła opcji "like"
                    }
            );

            let likeCounter = 0; // Dodajemy licznik polubień dla każdej opcji "like"

            const counterDiv = $('<div>').addClass('likeCounterDiv'); // Nowy div na licznik

            // Dodajemy ikonę do licznika
            const likeIcon = getLikeIcon(like);
            const iconContainer = $('<span>').addClass('likeIconContainer').append(likeIcon);
            counterDiv.append(iconContainer);

            const likeCounterSpan = $('<span>').addClass('likeCounter').text(` ${likeCounter} `);
            counterDiv.append(likeCounterSpan); // Licznik jest dodany po ikonie

            imgContainer.append(counterDiv); // Dodajemy licznik na zewnątrz kontenera przycisków

            likeOption.click(function (event) {
                event.preventDefault(); // Zapobiegamy domyślnej akcji przycisku

                // Inkrementujemy licznik polubień za każdym razem, gdy opcja "like" zostanie wybrana
                likeCounter++;
                likeCounterSpan.text(` ${likeCounter} `);

                const selectedLike = $(this).data('like');
                const selectedIcon = getLikeIcon(selectedLike);
                likeText.text(text);
                likeButton.removeClass('liked');
                addLikeIconToStoryButton(lastClickedIndex, selectedLike); // Dodaj ikonę do story_button na podstawie wybranej opcji "like"

                // Sprawdź, czy index już istnieje w tablicy
                const existingIndex = selectedLikes.findIndex(item => item.index === lastClickedIndex);
                if (existingIndex !== -1) {
                    // Jeśli index istnieje, zaktualizuj wartość
                    selectedLikes[existingIndex].like = selectedLike;
                } else {
                    // Jeśli index nie istnieje, dodaj nowy wpis
                    selectedLikes.push({index: lastClickedIndex, like: text}); // Dodaj tylko nazwę "like"
                }

                likeOptionsContainer.fadeOut('fast');
                saveSelectedLike(selectedLike, text); // Przekazujemy nazwę "like" i tekst do funkcji saveSelectedLike
            });

            return likeOption;
        }

// Funkcja do zapisywania wybranego "like"
        function saveSelectedLike(selectedLike, text) {
            // Tutaj możesz zapisać wybrany "like" w odpowiednim kontekście, np. wysłać go na serwer, zapisać w lokalnym magazynie itp.
            console.log('Wybrany like:', text);
            console.log('Tekst:', text);
            // Jeśli chcesz użyć go w innych miejscach, możesz przekazać go jako argument do innych funkcji lub zmiennych.
        }

        // Funkcja do pobierania ikony dla wybranego "like"
        function getLikeIcon(like) {
            let icon;
            switch (like) {
                case 'thumbsUp':
                    icon = $('<span class="likeIcon">👍</span>');
                    break;
                case 'heart':
                    icon = $('<span class="likeIcon">❤️</span>');
                    break;
                case 'star':
                    icon = $('<span class="likeIcon">⭐</span>');
                    break;
                default:
                    icon = $('<span class="likeIcon">👍</span>');
            }
            return icon;
        }

        const hashtagContainer = $('<a>').addClass('hashtag-container').attr('href', '#');
        fiszkaContainer.append(hashtagContainer);

        function showStory(index) {
            const currentFiszka = fiszkaContainer;

            // Ukrywamy wszystkie historie w tej konkretnej fiszce
            currentFiszka.find('.fiszka_story').hide();

            // Obsługa mnemoniki
            if (Array.isArray(fiszka.story)) {
                if (index >= 0 && index < fiszka.story.length) {
                    currentFiszka.find('.story-' + index).show();
                }
            } else if (fiszka.story) {
                currentFiszka.find('.story-0').show();
            }

            // Ukrywamy wszystkie obrazy
            currentFiszka.find('.fiszka_img').hide();

            // Obsługa obrazów
            let imgIndex; // Zmienna do przechowywania indeksu obrazka

            if (Array.isArray(fiszka.img)) {
                imgIndex = Math.min(index, fiszka.img.length - 1);
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img[imgIndex];
                console.log("Index obrazka:", imgIndex);
            } else {
                imgIndex = 0; // Ustawienie imgIndex na 0, gdy fiszka.img nie jest tablicą
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img;
                console.log("Index obrazka:", imgIndex);
            }

            lastClickedIndex = index;

            // Obsługa hashtagów
            const selectedCategoryIndex = index * 2;
            const value = fiszka.category1[selectedCategoryIndex];
            const hashtag = fiszka.category1[selectedCategoryIndex + 1];

            hashtagContainer.empty();
            hashtagContainer.text(`${value} #${hashtag}`);

            console.log('Calculated imgIndex:', imgIndex);

            return imgIndex;
        }

        function selectLikeButton(index) {
            console.log("Wybór likeButton dla indeksu:", index);
            const storyButton = $('.story_button').eq(index);
            if (!storyButton.length) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            const likeButton = storyButton.find('.like');
            likeText.find('span').remove();
            likeText.text('Śmieszna historia');

            // Sprawdź, czy index jest zawarty w tablicy selectedLikes
            const selectedLike = selectedLikes.find(item => item.index === index);
            if (selectedLike) {
                // Jeśli index istnieje w tablicy, ustaw ikonę przycisku na wartość z tablicy
                console.log("Wybrano like dla indeksu:", index, "- Like:", selectedLike.like);
                const selectedIcon = getLikeIcon(selectedLike.like); // Przekazujemy tylko nazwę ikony
                console.log('hej5', selectedIcon);
                likeText.html(selectedLike.like); // Ustawiamy ikonę
            } else {
                // Jeśli index nie istnieje, ustaw domyślny tekst
                console.log("Brak wyboru like dla indeksu:", index, "- Ustawianie domyślnego tekstu");
                likeButton.text('Śmieszna historia');
            }
        }
        // NIEZNACZĄCE WYJAŚNIENIE SŁOWA
        const sentenceDiv = $('<div>').attr('id', 'part');
        fiszka.sentence.forEach(word => {
            sentenceDiv.append($('<button>').text(word));
        });
        // Dodanie diva z przyciskami do kontenera fiszki
        fiszkaContainer.append(sentenceDiv);

        console.log('Przed utworzeniem wordDiv');
        const wordDiv = $('<div>').attr('id', 'word');
        const button = $('<button>').attr('id', 'storyone').html('<b>' + fiszka.desc + '</b>');
        const audio = $('<audio>').attr({
            id: 'music' + fiszka.id,
            preload: 'true'
        });
        const source = $('<source>').attr('src', fiszka.word);
        audio.append(source);
        const audioplayerDiv = $('<div>').attr('id', 'audioplayer' + fiszka.id).addClass('audioplayer'); // Dodano klasę 'audioplayer'
        const pButton = $('<button>').attr('id', 'pButton' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

        pButton.css({
            height: '60px',
            width: '60px',
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            float: 'left',
            outline: 'none',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden'
        });

        audioplayerDiv.append(pButton);
        wordDiv.append(button);
        wordDiv.append(audio);
        wordDiv.append(audioplayerDiv);
        fiszkaContainer.append(wordDiv);
        console.log('Po utworzeniu wordDiv');

// DODANIE MNEMOTECHNIKI
        if (Array.isArray(fiszka.story)) {
            // Jeśli story jest tablicą, iterujemy przez wszystkie jej elementy
            fiszka.story.forEach((story, index) => {
                const storyContainer = $('<div>').addClass('fiszka_story story-' + index).html(story);
                fiszkaContainer.append(storyContainer);
                console.log("Dodano story: ", story);  // Debugowanie
            });
        } else if (fiszka.story) {
            // Jeśli story jest pojedynczym stringiem, dodajemy go bezpośrednio
            const storyContainer = $('<div>').addClass('fiszka_story story-0').html(fiszka.story);
            fiszkaContainer.append(storyContainer);
            console.log("Dodano story: ", fiszka.story);  // Debugowanie
        }
        console.log('Przed utworzeniem wordDiv');

// Utworzenie reszty elementów zgodnie z istniejącym kodem
        const wordDiv2 = $('<div>').attr('id', 'word2');
        const audio2 = $('<audio>').attr({
            id: 'music2' + fiszka.id,
            preload: 'true'
        });
        const source2 = $('<source>').attr('src', fiszka.word);
        audio2.append(source2);
        const audioplayerDiv2 = $('<div>').attr('id', 'audioplayer2' + fiszka.id).addClass('audioplayer2'); // Dodano klasę 'audioplayer'
        const pButton2 = $('<button>').attr('id', 'pButton2' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

// Utworzenie elementów za pomocą jQuery
        const timelineDiv = $('<div>').attr('id', 'timeline' + fiszka.id);
        const playheadDiv = $('<div>').attr('id', 'playhead' + fiszka.id);

// Dodanie playhead do timeline
        timelineDiv.append(playheadDiv);

// Dodanie elementów do odpowiednich kontenerów
        audioplayerDiv.append(pButton2);
        wordDiv2.append(audio2);
        wordDiv2.append(audioplayerDiv2);
        wordDiv2.append(timelineDiv); // Dodano timeline do wordDiv
        fiszkaContainer.append(wordDiv2);

        console.log('Po utworzeniu wordDiv');
        // Zdefiniuj zmienną początkową na poziomie wyższym
        let initialSpecificLesson2Ref;
        let specificLesson2Ref;
        let lastClickedIndex = null;
        let lastApprovedIndex = null; // Zmienna do przechowywania ostatnio zatwierdzonego indeksu
        let approvedIndexes = []; // Tablica przechowująca zatwierdzone indeksy
        let approvedColors = [];

// DODANIE PRZYCISKÓW
        if (Array.isArray(fiszka.category1)) {
            const storyButtonContainer = $('<div>'); // Kontener na przyciski
            const randomIndex = Math.floor(Math.random() * fiszka.category1.length / 2);
            let lastClickedButton; // Zmienna do przechowywania ostatnio klikniętego przycisku w danej fiszce

            fiszka.category1.slice(0, 5).forEach((category1, index) => {
                const valueIndex = index * 2; // Indeks wartości w tablicy, zaczynając od 0
                const hashtagIndex = valueIndex + 1; // Indeks hashtagu w tablicy

                const value = fiszka.category1[valueIndex];
                const hashtag = fiszka.category1[hashtagIndex];

                const displayText = `${value} #${hashtag}`;

                const storyButton = $('<button>')
                        .text(displayText)
                        .addClass('story_button')
                        .click(function () {
                            showStory(index);
                            lastClickedIndex = index;

                            // Usuwamy zieloną klasę tylko z poprzedniego przycisku w danej fiszce
                            if (lastClickedButton) {
                                lastClickedButton.removeClass('green-button');
                            }

                            // Usuwamy klasę imgIndex z poprzedniego przycisku w danej fiszce
                            $('.story_button').removeClass((index, className) => (className.match(/imgIndex-\d+/g) || []).join(' '));
                            // Dodajemy klasę imgIndexNull do przycisków, które nie zostały jeszcze zatwierdzone
                            $('.fiszka').addClass('imgIndexNull').removeClass('imgIndex-0 imgIndex-1 imgIndex-2 imgIndex-3 imgIndex-4 ');

                            // Dodajemy zieloną klasę tylko dla aktualnie klikniętego przycisku w danej fiszce
                            $(this).addClass('green-button');
                            $('.story_button').removeClass('active-button');
                            $(this).addClass('active-button');
                            $('.story_button').each(function (index) {
                                if ($(this).hasClass('orange-button')) {
                                    $(this).removeClass('green-button');
                                    $(this).addClass('orange-button');
                                }
                            });

                            // Jeśli przycisk został wcześniej zatwierdzony, przywróć jego zatwierdzoną klasę
                            if (approvedIndexes.includes(lastClickedIndex)) {
                                fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
                            }

                            // Zapisujemy ostatnio kliknięty przycisk w danej fiszce
                            lastClickedButton = $(this);
                            handleLikeButtonClick();
                        });

                if (index === randomIndex) {
                    // Sprawdzamy, czy fiszka.img jest tablicą czy pojedynczą wartością
                    if (Array.isArray(fiszka.img)) {
                        newImgIndex = Math.min(index, fiszka.img.length - 1); // Aktualizacja zmiennej globalnej imgIndex
                        specificLesson2Ref = fiszka.img[newImgIndex];
                        console.log('hej432', specificLesson2Ref);
                    } else if (fiszka.img) {
                        newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
                        specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
                        console.log('hej432', specificLesson2Ref);
                    }
                    initialSpecificLesson2Ref = specificLesson2Ref;
                    console.log('Hej7', specificLesson2Ref);
                    storyButton.addClass('green-button');
                    lastClickedButton = storyButton;
                    lastApprovedIndex = index; // Ustaw ostatnio zatwierdzony indeks na indeks losowego przycisku
                }

                // Dodaj typ "like" dla tej fiszki do tablicy
                storyButtonContainer.append(storyButton);
            });

            fiszkaContainer.append(storyButtonContainer);

            // WYWOŁANIE TABLICY
            showStory(randomIndex);
            console.log(randomIndex);

            // Użycie specificLesson2Ref po załadowaniu strony
            console.log("Początkowy specificLesson2Ref:", initialSpecificLesson2Ref);

        } else if (fiszka.category1) {
            // Jeśli fiszka.category1 nie jest tablicą
            newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
            specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
            initialSpecificLesson2Ref = specificLesson2Ref;
            console.log('Hej7', specificLesson2Ref);

            // Stwórz pojedynczy przycisk dla pojedynczej wartości category1
            const displayText = `${fiszka.category1} #${fiszka.category1}`;
            const storyButton = $('<button>')
                    .text(displayText)
                    .addClass('story_button2 green-button') // Od razu przypisz zieloną klasę
                    .click(function () {
                        showStory(0); // Przekazujemy 0 jako indeks, ponieważ jest to pojedyncza wartość
                        lastClickedIndex = 0;

                        // Zapisujemy ostatnio kliknięty przycisk
                        lastClickedButton = $(this);
                        handleLikeButtonClick();
                    });

            fiszkaContainer.append(storyButton);
            lastClickedButton = storyButton;
            lastApprovedIndex = 0; // Ustaw ostatnio zatwierdzony indeks na 0

            // WYWOŁANIE POJEDYNCZEJ HISTORII
            showStory(0);
            console.log("Pojedyncza wartość dla category1, specificLesson2Ref:", specificLesson2Ref);
        }
        $('.fiszka_button_trening').click(function () {
            // Dodaj klasę pomarańczową tylko dla przycisku zatwierdzonego
            $('.story_button').each(function (index) {
                if ($(this).hasClass('green-button')) {
                    $(this).removeClass('green-button');
                    $(this).addClass('orange-button');
                }
            });
        });
        console.log('hej555ax', lessons2b[2]);
// DODANIE PRZYCISKU TRENING
        fiszkaContainer.append($('<button>').text('TRENING').addClass('fiszka_button fiszka_button_trening').click(function () {

            activateFiszka(fiszka.id, false);

            let id = fiszka.id;
            let parametr = '';

            // Sprawdzenie, czy idFiszki jest tablicą
            if (Array.isArray(fiszka.id)) {
                id = fiszka.id[0];         // Pierwszy element tablicy jako id
                parametr = fiszka.id[1] || ''; // Drugi element tablicy jako parametr, jeśli istnieje
            }

            // Tworzenie selektora na podstawie id i parametru
            const className = `fiszka-${id}\\,${parametr}`;
            const selector = `.${className}`;
            console.log('hej201', parametr);
            let first = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[0]) {
                first = true;
                console.log('hej200', first);

            }
            let second = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[1]) {
                second = true;
                console.log('hej200', second);

            }
            let third = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[2]) {
                third = true;
                console.log('hej200', third);

            }

            console.log("Trening clicked on fiszka nr " + fiszka.id);
            console.log("lessonId2:", lessonId2);
            console.log("nazwa", lessons2b[2]);
            // Wyswietlenie danej wartości img dla danej fiszka.id
            const specificLesson2 = specificLesson2Ref || initialSpecificLesson2Ref;
            console.log("img dla fiszki o id", fiszka.id, ":", specificLesson2);
            specificLesson2Ref = fiszka.img;
            // Znajdź indeks dla danej fiszki w tablicy lessons2[lessonId2]
            console.log('story55', specificLesson2Ref);
            // Używamy lastClickedIndex zamiast index
            imgIndex = showStory(lastClickedIndex); // Wywołanie funkcji showStory i zapisanie zwróconego indeksu obrazka
            console.log('działa', specificLesson2Ref);
            aktywujObrazek(first, second, third, specificLesson2, 'obrazek-container2b', true, fiszka, imgIndex); // Przekazanie imgIndex do funkcji aktywujObrazek
            // Dodajemy zatwierdzony indeks do tablicy
            approvedIndexes.push(lastClickedIndex);
            console.log(approvedIndexes);

            // Dodanie zatwierdzonej klasy imgIndex do fiszkaContainer po kliknięciu przycisku "TRENING"
            fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
        }));

        fiszkaContainer.append($('<button>').text('ZNAM').addClass('fiszka_button fiszka_button_znam').click(function () {
            console.log("Znam clicked on fiszka nr " + fiszka.id);
            activateFiszka(fiszka.id, true);
        }));

        // WYWOŁANIE HASHTAGU
        function updateButtonName(buttonName, fiszkaContainer) {
            // Usuń poprzednią nazwę, jeśli istnieje
            fiszkaContainer.find('.fiszka_button_name').remove();

            // Ustaw nazwę w prawym dolnym rogu fiszki
            const fiszkaButtonNameContainer = $('<div>').addClass('fiszka_button_name').text(buttonName);
            fiszkaContainer.append(fiszkaButtonNameContainer);
        }
        // Dodanie kontenera fiszki do body
        $(`.image-container4[data-lesson="${lessonId2}"]`).append(fiszkaContainer);
        console.log(`Generated fiszka block for ID: [${fiszka.id.join(', ')}]`);
        initAudio(fiszka.id);
    });
}



function getRandomFiszki(fiszkiArray, n) {
    const shuffledFiszki = fiszkiArray.sort(() => Math.random() - 0.5);
    return shuffledFiszki.slice(0, n);
}


function showFiszki() {
    const selectedFiszki = getRandomFiszki(fiszki, 18);
    // Wygeneruj bloki kodu dla wybranych fiszek
    selectedFiszki.forEach(fiszka => {
        console.log(fiszka);
        generateFiszkaBlock(fiszka);
    });
}
function removeFiszka(idFiszki, lessonId2) {
    let id = idFiszki;
    let parametr = '';

    if (Array.isArray(idFiszki)) {
        // Połącz wartości z tablicy id w jeden ciąg znaków oddzielony przecinkami
        id = idFiszki.slice(0, 3).join(',');
        // Obsługa ewentualnego dodatkowego parametru (np. czwartego elementu w tablicy)
        parametr = idFiszki.length > 3 ? idFiszki[3] : '';
    }

    // Tworzenie klasy CSS z odpowiednim formatowaniem (poprawione usunięcie przecinków w CSS)
    const className = `fiszka-${id}${parametr ? '\\,' + parametr : ''}`;
    const selector = `.${className.replace(/,/g, '\\,')}`;
    console.log(selector);
    const $fiszkaToRemove = $(selector);
    if ($fiszkaToRemove.length) {
        console.log('Element znaleziony po opóźnieniu, usuwam...');
        $fiszkaToRemove.remove();
    } else {
        console.log('Element nadal nie znaleziony.');
    }
}
// Dodajemy styl dla zielonego przycisku
$('<style>.green-button { background-color: green; color: white; }</style>').appendTo('head');
// Dodajemy styl dla aktywnego przycisku
$('<style>.active-button { border: 2px solid red; }</style>').appendTo('head');

window.fiszki = fiszki;