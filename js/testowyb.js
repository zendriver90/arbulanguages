const fiszki = [
    {
    id: [1, 1, 1],
    entries: [
        {
            id: 1,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/1a.jpg",
                alt: "Zdjęcie przedstawiające e-sportową grę"
            },
            story: {
                text: 'W <span class="adannotation" data-annotation="1"><u><b>e</u></b></span>-sportowej grze silnik samochodu robi <span class="adannotation" data-annotation="2"><u><b>wry</u></b></span>, <u><b>wszyscy</u></b> chcą takich rajdów, <span class="adannotation" data-annotation="3"><u><b>bo</u></b></span> idzie <span class="adannotation" data-annotation="4"><u><b>dy</u></b></span>m',
                alt: "Emocje dotyczące e-sportowej gry"
            },
            category: ["sport", "gaming"]
        },
        {
            id: 2,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/1b.jpg",
                alt: "Zdjęcie przedstawiające gotowanie"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>Ew</u></b></span>a robi <span class="adannotation" data-annotation="2"><u><b>ry</u></b></span>by, <span class="adannotation" data-annotation="3"><u><b>bo</u></b></span> będzie robiła zupę rybną, a na drugie placki z <span class="adannotation" data-annotation="4"><u><b>dy</u></b></span>ni. <u><b>Każdemu</u></b> to smakowało',
                alt: "Ewa robi obiad"
            },
            category: ["natura", "kulinaria"]
        },
        {
            id: 3,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/1c.jpg",
                alt: "Zdjęcie przedstawiające badanie pacjenta"
            },
            story: {
                text: 'Kr<span class="adannotation" data-annotation="1"><u><b>ew</u></b></span> każdego pacjenta jest dokładnie przebadana i organizm <u><b>wszystkich</u></b> pacjentów wraca na właściwe to<span class="adannotation" data-annotation="2"><u><b>ry</u></b></span>, <span class="adannotation" data-annotation="3"><u><b>bo</u></b></span> g<span class="adannotation" data-annotation="4"><u><b>dy</u></b></span> ma dobrą opiekę wraca do zdrowia',
                alt: "Badanie pacjenta"
            },
            category: ["nauka", "medycyna"]
        },
        {
            id: 4,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/1d.jpg",
                alt: "Zdjęcie przedstawiające modelarstwo"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>E</u></b></span>dek robi <span class="adannotation" data-annotation="2"><u><b>wry</u></b></span> swoim modelem samolotu, musi uważać, <span class="adannotation" data-annotation="3"><u><b>bo</u></b></span> jest silny wiatr. Z silnika samolotu się <span class="adannotation" data-annotation="4"><u><b>dy</u></b></span>mi i <u><b>wszyscy</u></b> się na to patrzą',
                alt: "Oddawanie się pasji modelarstwa"
            },
            category: ["czarny humor", "pasja"]
        },
        {
            id: 5,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/1e.jpg",
                alt: "Zdjęcie przedstawiające wychowanie dziecka"
            },
            story: {
                text: 'Moja córka <span class="adannotation" data-annotation="1"><u><b>Ew</u></b></span>a b<span class="adannotation" data-annotation="2"><u><b>ry</u></b></span>ka, <span class="adannotation" data-annotation="3"><u><b>bo</u></b></span> pojechała na zawo<span class="adannotation" data-annotation="4"><u><b>dy</u></b></span> jak <u><b>wszyscy</u></b> jej rówieśnicy',
                alt: "Wychowanie dzieci"
            },
            category: ["związki", "wychowanie"]
        }
    ],
        translate: "Wszyscy mają ubaw na zabawie",
        translateb: "[Ewrybody hes fan at de party]",
        translateb2: "[Ewrybody hes fan]",
        srcWord: ["https://www.arbulang.com/filmy/party.mp4", "The Matrix Reloaded"],
        srcWord2: ["https://www.arbulang.com/filmy/procedure.mp4", "Breaking Bad"],
        srcWordimage: "https://www.arbulang.com/filmy/party.png",
        word: [
            "https://www.arbulang.com/src/everybody.wav"
        ],

        // opis
        desc: "everybody[e-wry-bo-dy] - wszyscy",

        //zdanie
        sentence1: [
            "Everybody"
        ],
        sentence: [
            "Everybody",
            "has",
            "fun"
        ],
        //  slowo do nauki
        key: "Everybody",
        key2: ["wszyscy"],
        key3: ["każdy"],
        category2: ["osoby"],
        category3: ["PresentSimple", "PresentSimplePodmiot"]
    },
    {
    id: [2, 1, 1],
    entries: [
        {
            id: 1,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/2a.jpg",
                alt: "Kupowanie biletu"
            },
            story: {
                text: 'W niemieckim mieście <span class="adannotation" data-annotation="1"><u><b>Hess</u></b></span>en Jurek <u><b>ma</u></b> bilet na mecze jego drużyny',
                alt: "Przygotowanie do widowiska sportowego"
            },
            category: ["sport", "kibic"]
        },
        {
            id: 2,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/2b.jpg",
                alt: "Zdjęcie cyrku"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>H</u></b></span>ipopotam występuje w cyrku na <span class="adannotation" data-annotation="2"><u><b>es</u></b></span>tradzie, <u><b>ma</u></b> duże umiejętności',
                alt: "Pokazy cyrkowe. Żart o cyrku"
            },
            category: ["natura", "rozrywka"]
        },
        {
            id: 3,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/2c.jpg",
                alt: "Proces badania krwi. AI generated"
            },
            story: {
                text: 'Naukowiec nagle się zapomniał i zapytał: <span class="adannotation" data-annotation="1"><u><b>he</u></b></span>?, a wtedy jego kolega <u><b>ma</u></b> niezłą zabawę, <span class="adannotation" data-annotation="2"><u><b>s</u></b></span>prawa oczywista..',
                alt: "Obyczaje naukowca. Żart o naukowcu"
            },
            category: ["nauka", "humor"]
        },
        {
            id: 4,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/2d.jpg",
                alt: "Zdjęcie przedstawiające modelarstwo"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>He</u></b></span>gemonia konsumpcjonizmu doprowadziła do tego, że "ON"-dyrektor ma problemy, bo nikt nie chce chodzić na <span class="adannotation" data-annotation="2"><u><b>s</u></b></span>pektakle teatralne',
                alt: "Życie współczesne i kultura. Żart o teatrze"
            },
            category: ["czarny humor", "trendy"]
        },
        {
            id: 5,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/2e.jpg",
                alt: "Zdjęcie przedstawiające wychowanie dziecka"
            },
            story: {
                text: 'Moja koleżanka <u><b>ma</u></b> nowy klarnet z drzewa <span class="adannotation" data-annotation="1"><u><b>he</u></b></span>banowego. <span class="adannotation" data-annotation="2"><u><b>S</u></b></span>....uper sprawa',
                alt: "Wychowanie dzieci"
            },
            category: ["związki", "muzyka"]
        }
    ],
        word: [
            "https://www.arbulang.com/src/has.wav"
        ],
        desc: "has[hes]/have[hew] - mieć(on/ona/oni)/mieć(ja/ty)",
        sentence1: [
            "has"
        ],
        sentence: [
            "Everybody",
            "has",
            "fun"
        ],
        key: "has",
        key2: ["ma"],
        category2: ["czasownik"],
        category3: ["PresentSimple", "PresentSimpleCzasownik"]
    },
    {
    id: [3, 1, 1],
    entries: [
        {
            id: 1,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/3a.jpg",
                alt: "Kibice na meczu. AI generated"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>Fan</u></b></span>tastycznie jest być fanem jakiejś drużyny, to doskonała <u><b>zabawa</u></b>',
                alt: "Widowisko sportowe i kibicowanie"
            },
            category: ["sport", "kibic"]
        },
        {
            id: 2,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/3b.jpg",
                alt: "Zdjęcie cyrku"
            },
            story: {
                text: 'Na łonie natury jest <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tastyczna <u><b>zabawa</u></b> do rozmyślań i fanaberie stają się pięknymi myślami',
                alt: "Obcowanie z łonem przyrody"
            },
             category: ["natura", "czas wolny"]
        },
        {
            id: 3,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/3c.jpg",
                alt: "Niesamowite budowle. AI generated"
            },
            story: {
                text: 'Futurologia to nauka o przyszłości z dozą <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tazji. Futurolodzy mają z tego <u><b>zabawę</u></b>',
                alt: "Przewidywanie przyszłości - futurologia"
            },
            category: ["nauka", "fantastyka"]
        },
        {
            id: 4,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/3d.jpg",
                alt: "Arystokracja"
            },
            story: {
                text: 'Zarobiłem w złotówkach, a wydam w funtach. Mam z tego <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tastyczną <u><b>zabawę</u></b>',
                alt: "Biznes i wydawanie pieniędzy"
            },
            category: ["czarny humor", "giełda"]
        },
        {
            id: 5,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/3e.jpg",
                alt: "Zdjęcie na koncercie"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>Fan</b></u></span>tastyczne jest to by się dobrze <u><b>bawić</b></u>. A jeżli chodzi o <u><b>zabawę</b></u> zawsze jestem jej <u><b>fan</b></u>em',
                alt: "Spędzanie czasu wolnego. Jak spędzać czas wolny?"
            },
            category: ["związki", "muzyka"]
        }
    ],
        word: [
            "https://www.arbulang.com/src/has.wav"
        ],
        desc: "fun[fan] - zabawa",
        sentence1: [
            "fun"
        ],
        sentence: [
            "Everybody",
            "has",
            "fun"
        ],
        key: "fun",
       key2: ["zabawa"],
       key3: ["ubaw", "uciecha", "heca"],
        category2: ["nawa czynności"]
    },
        {
    id: [4, 1, 2],
    entries: [
        {
            id: 1,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/4a.jpg",
                alt: "Kibice na meczu. AI generated"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>Fan</u></b></span>tastycznie jest być fanem jakiejś drużyny, to doskonała <u><b>zabawa</u></b>',
                alt: "Widowisko sportowe i kibicowanie"
            },
            category: ["sport", "kibic"]
        },
        {
            id: 2,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/4b.jpg",
                alt: "Zdjęcie cyrku"
            },
            story: {
                text: 'Na łonie natury jest <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tastyczna <u><b>zabawa</u></b> do rozmyślań i fanaberie stają się pięknymi myślami',
                alt: "Obcowanie z łonem przyrody"
            },
             category: ["natura", "czas wolny"]
        },
        {
            id: 3,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/4c.jpg",
                alt: "Niesamowite budowle. AI generated"
            },
            story: {
                text: 'Futurologia to nauka o przyszłości z dozą <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tazji. Futurolodzy mają z tego <u><b>zabawę</u></b>',
                alt: "Przewidywanie przyszłości - futurologia"
            },
            category: ["nauka", "fantastyka"]
        },
        {
            id: 4,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/4d.jpg",
                alt: "Arystokracja"
            },
            story: {
                text: 'Zarobiłem w złotówkach, a wydam w funtach. Mam z tego <span class="adannotation" data-annotation="1"><u><b>fan</u></b></span>tastyczną <u><b>zabawę</u></b>',
                alt: "Biznes i wydawanie pieniędzy"
            },
            category: ["czarny humor", "giełda"]
        },
        {
            id: 5,
            img: {
                src: "https://www.arbulang.com/img/fiszki1/4e.jpg",
                alt: "Zdjęcie na koncercie"
            },
            story: {
                text: '<span class="adannotation" data-annotation="1"><u><b>Fan</b></u></span>tastyczne jest to by się dobrze <u><b>bawić</b></u>. A jeżli chodzi o <u><b>zabawę</b></u> zawsze jestem jej <u><b>fan</b></u>em',
                alt: "Spędzanie czasu wolnego. Jak spędzać czas wolny?"
            },
            category: ["związki", "muzyka"]
        }
    ],
        word: [
            "https://www.arbulang.com/src/has.wav"
        ],
        desc: "at[at] - w tym",
        sentence2: [
            "at"
        ],
        sentence: [
            "at",
            "the",
            "party"
        ],
        key: "at",
                key2: ["na"],
                key3: ["w", "na", "z", "przy", "o", "do", "u", "po", "za", "ze", "we", "w stanie"],
        category2: ""
    }
];


function addToTrainingList(idFiszki) {
    // dodaj do local storage do treningu
    addFiszkaToLesson(idFiszki);
}
function activateFiszka(idFiszki, znam) {
    let id = idFiszki;
    let parametr = '';

    if (Array.isArray(idFiszki)) {
        // Połącz wartości z tablicy id w jeden ciąg znaków oddzielony przecinkami
        id = idFiszki.slice(0, 3).join(',');
        // Obsługa ewentualnego dodatkowego parametru (np. czwartego elementu w tablicy)
        parametr = idFiszki.length > 3 ? idFiszki[3] : '';
    }

    // Tworzenie klasy CSS z odpowiednim formatowaniem (poprawione usunięcie przecinków w CSS)
    const className = `fiszka-${id}${parametr ? '\\,' + parametr : ''}`;
    const selector = `.${className.replace(/,/g, '\\,')}`;
    console.log(selector);

    if (znam) {
        // Zapisz klasę 'active' lub zmień z 'active2' na 'active'
        if ($(selector).hasClass('active2')) {
            $(selector).removeClass('active2').addClass('active');
            updateLearnedClass(className, 'active');
        } else {
            $(selector).addClass('active');
            saveLearnedClass(className, 'active');
        }
        setAsLearned(id);
        console.log(`Set fiszka with ID ${id} as learned.`);
    } else {
        // Zapisz klasę 'active2' lub usuń 'active'
        $(selector).removeClass('active').addClass('active2');
        saveLearnedClass(className, 'active2');
        addToTrainingList(id);
        console.log(`Clicked - fiszka with ID ${id} added to training list.`);
        console.log('Clicked', $(selector));
    }
}



// Funkcja do zapisywania klasy w Local Storage
function saveLearnedClass(className, classToAdd) {
    let learnedClasses = getLearned2();
    const existingEntryIndex = learnedClasses.findIndex(entry => entry.className === className);

    if (existingEntryIndex !== -1) {
        // Jeśli już istnieje, zaktualizuj klasę
        learnedClasses[existingEntryIndex].classToAdd = classToAdd;
    } else {
        // W przeciwnym razie dodaj nowy wpis
        learnedClasses.push({className, classToAdd});
    }

    localStorage.setItem('ColorClass', JSON.stringify(learnedClasses));
    console.log('ColorClass', learnedClasses);
}

// Funkcja do aktualizacji klasy 'active' w Local  Storage
function updateLearnedClass(className, classToUpdate) {
    let learnedClasses = getLearned2();
    const existingEntryIndex = learnedClasses.findIndex(entry => entry.className === className);

    if (existingEntryIndex !== -1) {
        // Jeśli już istnieje, zaktualizuj klasę
        learnedClasses[existingEntryIndex].classToAdd = classToUpdate;
        localStorage.setItem('ColorClass', JSON.stringify(learnedClasses));
        console.log('ColorClass', learnedClasses);
    }
}

// Funkcja do odzyskiwania klas z Local Storage
function getLearned2() {
    const storedColorClass = localStorage.getItem('ColorClass');
    return storedColorClass ? JSON.parse(storedColorClass) : [];
}

// Wywołanie klas po odświeżeniu strony
$(document).ready(function () {
    const learnedClasses = getLearned2();
    learnedClasses.forEach(function (entry) {
        $(`.${entry.className}`).addClass(entry.classToAdd);
    });
});
let lessons2b = {};

// Funkcja do zapisywania danych do localStorage
function saveToLocalStorage(data) {
    localStorage.setItem('wylosowaneLekcje', JSON.stringify(data));
}

// Funkcja do wczytywania danych z localStorage
function loadFromLocalStorage() {
    const storedData = localStorage.getItem('wylosowaneLekcje');
    return storedData ? JSON.parse(storedData) : null;
}

const storedLessons = loadFromLocalStorage();



// Sprawdzanie zawartości lessons2b po załadowaniu danych
function printLessons2b() {
    console.log('hej555', lessons2b[2]);
}

// Wywołaj tę funkcję, gdy masz pewność, że dane zostały załadowane
document.addEventListener('DOMContentLoaded', function () {
    setTimeout(printLessons2b, 1000);  // Opóźnienie dla pewności
});

function generateFiszkaBlock(fiszka, lessonId2) {

    var currentStoryButtonName = ''; // Zmienna lokalna
    console.log(`Generating fiszka block for ID: [${fiszka}]`);

    // Tworzenie kontenera fiszki

    $(document).ready(function () {

        function initAudio(fiszkaId) {
            var audioId = 'music' + fiszkaId;
            var pButtonId = 'pButton' + fiszkaId;

            var music = document.getElementById(audioId);
            var pButton = document.getElementById(pButtonId);
            // Dodajemy style bezpośrednio w kodzie JavaScript
            if (window.matchMedia("(max-width: 999px)").matches) {
                pButton.style.height = '100px';  // Zwiększenie wysokości
                pButton.style.width = '100px';   // Zwiększenie szerokości
            } else {
                pButton.style.height = '60px';  // Zwiększenie wysokości
                pButton.style.width = '60px';   // Zwiększenie szerokości
            }
            pButton.style.border = 'none';   // Usunięcie ramki
            pButton.style.backgroundSize = '80%';  // Rozmiar obrazka tła
            pButton.style.backgroundRepeat = 'no-repeat';
            pButton.style.backgroundPosition = 'center';
            pButton.style.borderRadius = '8px';   // Zaokrąglenie rogów
            pButton.style.outline = 'none';       // Usunięcie obramowania
            pButton.style.display = 'flex';       // Wyśrodkowanie zawartości
            pButton.style.alignItems = 'center';
            pButton.style.justifyContent = 'center';
            pButton.style.overflow = 'hidden';    // Ukrycie nadmiarowego kontentu
            console.log('Initialized audio element with ID:', audioId);
            console.log('Initialized play/pause button with ID:', pButtonId);

            // Play and Pause
            function playb() {
                // start music
                if (music.paused) {
                    music.play();
                    // remove play, add pause
                    pButton.classList.remove("play");
                    pButton.classList.add("pause");
                } else { // pause music
                    music.pause();
                    // remove pause, add play
                    pButton.classList.remove("pause");
                    pButton.classList.add("play");
                }
                console.log('Audio playback status:', music.paused ? 'Paused' : 'Playing');
            }

            // Gets audio file duration
            music.addEventListener("canplaythrough", function () {
                var duration = music.duration;
                console.log('Audio duration:', duration);
            }, false);

            // Dodajemy event listener do przycisku play/pause
            pButton.addEventListener('click', playb);

            console.log('Audio initialization completed.');
        }

// TWORZENIE KONTENERA FISZKI
        let fiszkaContainer = $('<div>').addClass('fiszka fiszka-' + fiszka.id);
console.log('Hej4442', fiszkaContainer);

const imgContainer = $('<div>').addClass('fiszka_img_container');
        fiszka.entries.forEach(entry => {
            // Tworzymy kontener dla zdjęć

            // Sprawdzamy, czy img to tablica (może być więcej niż jedno zdjęcie)
            if (Array.isArray(entry.img)) {
                entry.img.forEach((imgObj, index) => {
                    const imgElement = $('<img class="fiszka_img">')
                        .attr('src', imgObj.src)  // Dodanie URL obrazka
                        .attr('alt', imgObj.alt); // Dodanie ALT
                    imgContainer.append(imgElement);
                    if (index > 0) {
                        imgElement.hide(); // Ukrywanie dodatkowych zdjęć
                    }
                });
            } else if (typeof entry.img === 'object' && entry.img !== null) {
                // Jeśli img to pojedynczy obiekt
                const imgElement = $('<img class="fiszka_img">')
                    .attr('src', entry.img.src)
                    .attr('alt', entry.img.alt);
                imgContainer.append(imgElement);
            }

            // Tworzymy kontener dla historii
            const storyContainer = $('<div>').addClass('story').html(entry.story.text);

            // Dodajemy kontener obrazków i historii do kontenera fiszki
            const fiszkaContainer = $('<div>').addClass('fiszka');

        });
            fiszkaContainer.append(imgContainer);
        const selectedLikes = [];
        console.log('hej10', selectedLikes);

// Funkcja do obsługi kliknięcia na przycisk "likeButton"
        function handleLikeButtonClick(index) {
            const likeButton = $(this);
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            const selectedLike = likeButton.text();
            console.log('Zaktualizowano przycisk dla indeksu:', index);
            console.log('Aktualne wartości selectedLikes:', selectedLikes);
        }
        const likeButton = $('<a>').addClass('like').attr('href', '#');
        const likeText = $('<span>').text('Śmieszna historia');
        likeButton.append(likeText);
        fiszkaContainer.append(likeButton);

        // Tworzymy kontener opcji "like" i dodajemy opcje do kontenera
        const likeOptionsContainer = $('<div>').attr('id', 'likeOptionsContainer');
        const likeOption1 = createLikeOption('thumbsUp', '👍 Śmieszne');
        const likeOption2 = createLikeOption('heart', '❤️ Miłe');
        const likeOption3 = createLikeOption('star', '⭐ Pamiętliwe');
        likeOptionsContainer.append(likeOption1, likeOption2, likeOption3);

        // Dodajemy kontener opcji "like" do docelowego kontenera
        likeButton.append(likeOptionsContainer);

        // Ukrywamy kontener opcji "like"
        likeOptionsContainer.hide();

        // Obsługa zdarzenia hover na przycisku "like"
        likeButton.hover(function () {
            const buttonPosition = likeButton.offset();
            const buttonWidth = likeButton.outerWidth();

            // Pozycjonujemy kontener opcji "like" nad przyciskiem
            likeOptionsContainer.css({
                top: buttonPosition.top - likeOptionsContainer.outerHeight() - 10,
                left: buttonPosition.left + (buttonWidth / 2) - (likeOptionsContainer.outerWidth() / 2),
                backgroundColor: '#f0f0f0', // Dodajemy szary kolor tła
            }).fadeIn('fast');
        }, function () {
            // Ukrywamy kontener opcji "like" po zjechaniu z przycisku
            likeOptionsContainer.fadeOut('fast');
        });

// Funkcja do umieszczania ikony obok przycisku "story_button" w odpowiedniej fiszce
        function addLikeIconToStoryButton(index, like) {
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            if (storyButton.length === 0) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            // Tworzymy kontener dla ikony i dodajemy ikonę
            const iconContainer = $('<div>').addClass('likeIconContainer');
            const likeIcon = getLikeIcon(like);
            iconContainer.append(likeIcon);

            // Usuwamy wcześniej dodaną ikonę, jeśli istnieje
            storyButton.find('.likeIconContainer').remove();

            // Dodajemy kontener z ikoną do przycisku "story_button"
            storyButton.append(iconContainer);
        }

        function createLikeOption(like, text) {
            const likeOption = $('<div>').addClass('likeOption').attr('data-like', like).text(text);

            // Dodajemy efekt zmiany koloru na lekko ciemniejszy szary po najechaniu myszką na pojedynczą opcję "like"
            likeOption.hover(
                    function () {
                        likeOption.css('background-color', '#dcdcdc'); // Lekko ciemniejszy szary kolor tła dla opcji "like"
                    },
                    function () {
                        likeOption.css('background-color', ''); // Usuwamy styl, aby wrócić do domyślnego tła opcji "like"
                    }
            );

            let likeCounter = 0; // Dodajemy licznik polubień dla każdej opcji "like"

            const counterDiv = $('<div>').addClass('likeCounterDiv'); // Nowy div na licznik

            // Dodajemy ikonę do licznika
            const likeIcon = getLikeIcon(like);
            const iconContainer = $('<span>').addClass('likeIconContainer').append(likeIcon);
            counterDiv.append(iconContainer);

            const likeCounterSpan = $('<span>').addClass('likeCounter').text(` ${likeCounter} `);
            counterDiv.append(likeCounterSpan); // Licznik jest dodany po ikonie

            imgContainer.append(counterDiv); // Dodajemy licznik na zewnątrz kontenera przycisków

            likeOption.click(function (event) {
                event.preventDefault(); // Zapobiegamy domyślnej akcji przycisku

                // Inkrementujemy licznik polubień za każdym razem, gdy opcja "like" zostanie wybrana
                likeCounter++;
                likeCounterSpan.text(` ${likeCounter} `);

                const selectedLike = $(this).data('like');
                const selectedIcon = getLikeIcon(selectedLike);
                likeText.text(text);
                likeButton.removeClass('liked');
                addLikeIconToStoryButton(lastClickedIndex, selectedLike); // Dodaj ikonę do story_button na podstawie wybranej opcji "like"

                // Sprawdź, czy index już istnieje w tablicy
                const existingIndex = selectedLikes.findIndex(item => item.index === lastClickedIndex);
                if (existingIndex !== -1) {
                    // Jeśli index istnieje, zaktualizuj wartość
                    selectedLikes[existingIndex].like = selectedLike;
                } else {
                    // Jeśli index nie istnieje, dodaj nowy wpis
                    selectedLikes.push({index: lastClickedIndex, like: text}); // Dodaj tylko nazwę "like"
                }

                likeOptionsContainer.fadeOut('fast');
                saveSelectedLike(selectedLike, text); // Przekazujemy nazwę "like" i tekst do funkcji saveSelectedLike
            });

            return likeOption;
        }

// Funkcja do zapisywania wybranego "like"
        function saveSelectedLike(selectedLike, text) {
            // Tutaj możesz zapisać wybrany "like" w odpowiednim kontekście, np. wysłać go na serwer, zapisać w lokalnym magazynie itp.
            console.log('Wybrany like:', text);
            console.log('Tekst:', text);
            // Jeśli chcesz użyć go w innych miejscach, możesz przekazać go jako argument do innych funkcji lub zmiennych.
        }

        // Funkcja do pobierania ikony dla wybranego "like"
        function getLikeIcon(like) {
            let icon;
            switch (like) {
                case 'thumbsUp':
                    icon = $('<span class="likeIcon">👍</span>');
                    break;
                case 'heart':
                    icon = $('<span class="likeIcon">❤️</span>');
                    break;
                case 'star':
                    icon = $('<span class="likeIcon">⭐</span>');
                    break;
                default:
                    icon = $('<span class="likeIcon">👍</span>');
            }
            return icon;
        }

        const hashtagContainer = $('<a>').addClass('hashtag-container').attr('href', '#');
        fiszkaContainer.append(hashtagContainer);

// Funkcja showStory z obsługą id.fiszki
function showStory(idFiszki) {
    console.log('Wywołano showStory:', idFiszki);

    const currentFiszka = fiszkaContainer;
    console.log('Aktualny kontener:', currentFiszka);

    // Ukrywamy wszystkie historie i obrazy w tej konkretnej fiszce
    currentFiszka.find('.fiszka_img').hide();

    // Pobieramy odpowiednią fiszkę z tablicy fiszki na podstawie idFiszki
    const currentEntry = fiszka.entries[idFiszki];
    
    if (!currentEntry) {
        console.error("Nie znaleziono fiszki dla id:", idFiszki);
        return;
    }

    console.log("Wybrana fiszka:", currentEntry);

    let imgIndex = 0; // Domyślny indeks, jeśli coś pójdzie nie tak

    if (Array.isArray(fiszka.entries) && fiszka.entries.length > 0) {
        // Wybór losowego indeksu dla obrazka
        imgIndex = Math.floor(Math.random() * fiszka.entries.length);
        console.log("Wylosowany indeks obrazka:", imgIndex);
    }

    // Pobieramy wylosowany obrazek
    const selectedImg = currentEntry.img;
    
    if (selectedImg) {
        // Ustawiamy obrazek, który ma być widoczny
        currentFiszka.find('.fiszka_img').each(function() {
            if ($(this).attr('src') === selectedImg.src) {
                $(this).show(); // Pokazujemy wybrany obrazek
            }
        });
        
        // Ustawienie specificLesson2Ref z pełnymi danymi
        specificLesson2Ref = {
            src: selectedImg.src,
            alt: selectedImg.alt
        };

        console.log("Losowy obrazek:", specificLesson2Ref);
    } else {
        console.warn("Brak obrazka w fiszce:", currentEntry);
    }

    // Obsługa `story`, jeśli istnieje
    if (currentEntry.story) {
        const storyText = currentEntry.story.text;
        const storyElement = $('<div>').addClass('fiszka_story story-' + imgIndex).html(storyText);

        // Usunięcie starych historii i dodanie nowej
        currentFiszka.find('.fiszka_story').remove();
        currentFiszka.append(storyElement);
        storyElement.show();
    }

    lastClickedIndex = idFiszki;

    return imgIndex;
}

        function selectLikeButton(index) {
            console.log("Wybór likeButton dla indeksu:", index);
            const storyButton = $('.story_button').eq(index);
            if (!storyButton.length) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            const likeButton = storyButton.find('.like');
            likeText.find('span').remove();
            likeText.text('Śmieszna historia');

            // Sprawdź, czy index jest zawarty w tablicy selectedLikes
            const selectedLike = selectedLikes.find(item => item.index === index);
            if (selectedLike) {
                // Jeśli index istnieje w tablicy, ustaw ikonę przycisku na wartość z tablicy
                console.log("Wybrano like dla indeksu:", index, "- Like:", selectedLike.like);
                const selectedIcon = getLikeIcon(selectedLike.like); // Przekazujemy tylko nazwę ikony
                console.log('hej5', selectedIcon);
                likeText.html(selectedLike.like); // Ustawiamy ikonę
            } else {
                // Jeśli index nie istnieje, ustaw domyślny tekst
                console.log("Brak wyboru like dla indeksu:", index, "- Ustawianie domyślnego tekstu");
                likeButton.text('Śmieszna historia');
            }
        }
        // NIEZNACZĄCE WYJAŚNIENIE SŁOWA
        const sentenceDiv = $('<div>').attr('id', 'part');
        fiszka.sentence.forEach(word => {
            sentenceDiv.append($('<button>').text(word));
        });
        // Dodanie diva z przyciskami do kontenera fiszki
        fiszkaContainer.append(sentenceDiv);

        console.log('Przed utworzeniem wordDiv');
        const wordDiv = $('<div>').attr('id', 'word');
        const button = $('<button>').attr('id', 'storyone').html('<b>' + fiszka.desc + '</b>');
        const audio = $('<audio>').attr({
            id: 'music' + fiszka.id,
            preload: 'true'
        });
        const source = $('<source>').attr('src', fiszka.word);
        audio.append(source);
        const audioplayerDiv = $('<div>').attr('id', 'audioplayer' + fiszka.id).addClass('audioplayer'); // Dodano klasę 'audioplayer'
        const pButton = $('<button>').attr('id', 'pButton' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

        pButton.css({
            height: '60px',
            width: '60px',
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            float: 'left',
            outline: 'none',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden'
        });

        audioplayerDiv.append(pButton);
        wordDiv.append(button);
        wordDiv.append(audio);
        wordDiv.append(audioplayerDiv);
        fiszkaContainer.append(wordDiv);
        console.log('Po utworzeniu wordDiv');

// DODANIE MNEMOTECHNIKI
if (Array.isArray(fiszka.entries) && fiszka.entries.length > 0) {
            // Jeśli story jest tablicą, iterujemy przez wszystkie jej elementy
    fiszka.entries.forEach((story, index) => {
                const storyContainer = $('<div>').addClass('fiszka_story story-' + index).html(index);
                fiszkaContainer.append(storyContainer);
                console.log("Dodano story: ", index);  // Debugowanie
            });
        }
        console.log('Przed utworzeniem wordDiv');

// Utworzenie reszty elementów zgodnie z istniejącym kodem
        const wordDiv2 = $('<div>').attr('id', 'word2');
        const audio2 = $('<audio>').attr({
            id: 'music2' + fiszka.id,
            preload: 'true'
        });
        const source2 = $('<source>').attr('src', fiszka.word);
        audio2.append(source2);
        const audioplayerDiv2 = $('<div>').attr('id', 'audioplayer2' + fiszka.id).addClass('audioplayer2'); // Dodano klasę 'audioplayer'
        const pButton2 = $('<button>').attr('id', 'pButton2' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

// Utworzenie elementów za pomocą jQuery
        const timelineDiv = $('<div>').attr('id', 'timeline' + fiszka.id);
        const playheadDiv = $('<div>').attr('id', 'playhead' + fiszka.id);

// Dodanie playhead do timeline
        timelineDiv.append(playheadDiv);

// Dodanie elementów do odpowiednich kontenerów
        audioplayerDiv.append(pButton2);
        wordDiv2.append(audio2);
        wordDiv2.append(audioplayerDiv2);
        wordDiv2.append(timelineDiv); // Dodano timeline do wordDiv
        fiszkaContainer.append(wordDiv2);

        console.log('Po utworzeniu wordDiv');
let initialSpecificLesson2Ref;
let specificLesson2Ref;
let lastClickedIndex = null;
let lastApprovedIndex = null; // Zmienna do przechowywania ostatnio zatwierdzonego indeksu
let approvedIndexes = [];      // Tablica przechowująca zatwierdzone indeksy
let approvedColors = [];

// Zakładamy, że istnieje kontener dla fiszki: fiszkaContainer
let index10 = [];
if (Array.isArray(fiszka.entries) && fiszka.entries.length > 0) {
    console.log("Znaleziono fiszki, liczba wpisów:", fiszka.entries.length);
    
    const storyButtonContainer = $('<div>'); // Kontener na przyciski
    let lastClickedButton; // Przechowuje ostatnio kliknięty przycisk
    
    // Losujemy indeks przycisku, który ma być aktywny przy ładowaniu
    const randomButtonIndex = Math.floor(Math.random() * fiszka.entries.length);
    console.log("Wylosowany indeks przycisku:", randomButtonIndex);
index10.push(randomButtonIndex);
    fiszka.entries.forEach((entry, index) => {
        console.log(`Przetwarzanie fiszki nr ${index}:`, entry);
        const displayText = entry.category.join(", ");
        console.log(`Przetwarzanie fiszki nr ${index}:`, entry.category.join(", "));
        
        const storyButton = $('<button>') // Tworzymy przycisk
            .text(displayText)
            .addClass('story_button')
            .click(function () {
                console.log("Kliknięto przycisk dla fiszki nr:", index);

                // Dodajemy id.fiszki
                const idFiszki = entry.id || index;  // Przypisujemy id.fiszki, zakładając, że entry.id istnieje, w przeciwnym razie używamy index

                showStory(index, idFiszki);
                lastClickedIndex = index;

                // Usuwamy zieloną klasę tylko z poprzedniego przycisku w danej fiszce
                if (lastClickedButton) {
                    lastClickedButton.removeClass('green-button');
                }

                // Usuwamy klasę imgIndex z poprzedniego przycisku w danej fiszce
                $('.story_button').removeClass((index, className) => (className.match(/imgIndex-\d+/g) || []).join(' '));
                // Dodajemy klasę imgIndexNull do przycisków, które nie zostały jeszcze zatwierdzone
                $('.fiszka').addClass('imgIndexNull').removeClass('imgIndex-0 imgIndex-1 imgIndex-2 imgIndex-3 imgIndex-4 ');

                // Dodajemy zieloną klasę tylko dla aktualnie klikniętego przycisku w danej fiszce
                $(this).addClass('green-button');
                $('.story_button').removeClass('active-button');
                $(this).addClass('active-button');
                $('.story_button').each(function (index) {
                    if ($(this).hasClass('orange-button')) {
                        $(this).removeClass('green-button');
                        $(this).addClass('orange-button');
                    }
                });

                // Jeśli przycisk został wcześniej zatwierdzony, przywróć jego zatwierdzoną klasę
                if (approvedIndexes.includes(lastClickedIndex)) {
                    fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
                }

                // Zapisujemy ostatnio kliknięty przycisk w danej fiszce
                lastClickedButton = $(this);
                handleLikeButtonClick();
            });

        if (index === randomButtonIndex) {
            // Używamy indeksu przycisku, aby wybrać odpowiednią fiszkę
            specificLesson2Ref = entry.img[index];  // Obiekt img zawierający src i alt
            console.log('Zaktualizowano specificLesson2Ref:', specificLesson2Ref);
            storyButton.addClass('green-button');  // Nadajemy przyciskowi zieloną klasę
            lastClickedButton = storyButton;  // Przechowujemy referencję do ostatnio klikniętego przycisku
            lastApprovedIndex = index;  // Ustawiamy ostatnio zatwierdzony indeks
        }

        storyButtonContainer.append(storyButton);
        console.log(`Dodano przycisk do kontenera dla fiszki nr ${index}`);
    });
    
    fiszkaContainer.append(storyButtonContainer);
    console.log("Przyciski zostały dodane do kontenera");

    // Wywołujemy showStory dla wylosowanego przycisku
    const idFiszki = fiszka.entries[randomButtonIndex].id || randomButtonIndex;  // Przypisujemy id fiszki
    showStory(index10, idFiszki);
    console.log(`Wywołano showStory dla wylosowanego przycisku: ${randomButtonIndex} z id.fiszki: ${idFiszki}`);
}
        $('.fiszka_button_trening').click(function () {
            // Dodaj klasę pomarańczową tylko dla przycisku zatwierdzonego
            $('.story_button').each(function (index) {
                if ($(this).hasClass('green-button')) {
                    $(this).removeClass('green-button');
                    $(this).addClass('orange-button');
                }
            });
        });
        console.log('hej555ax', lessons2b[2]);
// DODANIE PRZYCISKU TRENING
        fiszkaContainer.append($('<button>').text('TRENING').addClass('fiszka_button fiszka_button_trening').click(function () {

            activateFiszka(fiszka.id, false);

            let id = fiszka.id;
            let parametr = '';

            // Sprawdzenie, czy idFiszki jest tablicą
            if (Array.isArray(fiszka.id)) {
                id = fiszka.id[0];         // Pierwszy element tablicy jako id
                parametr = fiszka.id[1] || ''; // Drugi element tablicy jako parametr, jeśli istnieje
            }

            // Tworzenie selektora na podstawie id i parametru
            const className = `fiszka-${id}\\,${parametr}`;
            const selector = `.${className}`;
            console.log('hej201', parametr);
            let first = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[0]) {
                first = true;
                console.log('hej200', first);

            }
            let second = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[1]) {
                second = true;
                console.log('hej200', second);

            }
            let third = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[2]) {
                third = true;
                console.log('hej200', third);

            }

            console.log("Trening clicked on fiszka nr " + fiszka.id);
            console.log("lessonId2:", lessonId2);
            console.log("nazwa", lessons2b[2]);
            // Wyswietlenie danej wartości img dla danej fiszka.id
            const specificLesson2 = specificLesson2Ref || initialSpecificLesson2Ref;
            console.log("img dla fiszki o id", fiszka.id, ":", specificLesson2);
            specificLesson2Ref = fiszka.img;
            // Znajdź indeks dla danej fiszki w tablicy lessons2[lessonId2]
            console.log('story55', specificLesson2Ref);
            // Używamy lastClickedIndex zamiast index
            imgIndex = showStory(lastClickedIndex); // Wywołanie funkcji showStory i zapisanie zwróconego indeksu obrazka
            console.log('działa', specificLesson2Ref);
            aktywujObrazek(first, second, third, specificLesson2, 'obrazek-container2b', true, fiszka, imgIndex); // Przekazanie imgIndex do funkcji aktywujObrazek
            // Dodajemy zatwierdzony indeks do tablicy
            approvedIndexes.push(lastClickedIndex);
            console.log(approvedIndexes);

            // Dodanie zatwierdzonej klasy imgIndex do fiszkaContainer po kliknięciu przycisku "TRENING"
            fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
        }));

        fiszkaContainer.append($('<button>').text('ZNAM').addClass('fiszka_button fiszka_button_znam').click(function () {
            console.log("Znam clicked on fiszka nr " + fiszka.id);
            activateFiszka(fiszka.id, true);
        }));

        // WYWOŁANIE HASHTAGU
        function updateButtonName(buttonName, fiszkaContainer) {
            // Usuń poprzednią nazwę, jeśli istnieje
            fiszkaContainer.find('.fiszka_button_name').remove();

            // Ustaw nazwę w prawym dolnym rogu fiszki
            const fiszkaButtonNameContainer = $('<div>').addClass('fiszka_button_name').text(buttonName);
            fiszkaContainer.append(fiszkaButtonNameContainer);
        }
        // Dodanie kontenera fiszki do body
        $('.grid-containerb').append(fiszkaContainer);
        console.log(`Generated fiszka block for ID: [${fiszka.id.join(', ')}]`);
        initAudio(fiszka.id);
    });
}
function generateFiszkaBlock2(fiszka, lessonId2) {
    console.log('hej555xxv', fiszka);
    var currentStoryButtonName = ''; // Zmienna lokalna
    console.log(`Generating fiszka block for ID: [${fiszka.id.join(', ')}]`);

    // Tworzenie kontenera fiszki

    $(document).ready(function () {

        function initAudio(fiszkaId) {
            var audioId = 'music' + fiszkaId;
            var pButtonId = 'pButton' + fiszkaId;

            var music = document.getElementById(audioId);
            var pButton = document.getElementById(pButtonId);
            // Dodajemy style bezpośrednio w kodzie JavaScript
            if (window.matchMedia("(max-width: 999px)").matches) {
                pButton.style.height = '100px';  // Zwiększenie wysokości
                pButton.style.width = '100px';   // Zwiększenie szerokości
            } else {
                pButton.style.height = '60px';  // Zwiększenie wysokości
                pButton.style.width = '60px';   // Zwiększenie szerokości
            }
            pButton.style.border = 'none';   // Usunięcie ramki
            pButton.style.backgroundSize = '80%';  // Rozmiar obrazka tła
            pButton.style.backgroundRepeat = 'no-repeat';
            pButton.style.backgroundPosition = 'center';
            pButton.style.borderRadius = '8px';   // Zaokrąglenie rogów
            pButton.style.outline = 'none';       // Usunięcie obramowania
            pButton.style.display = 'flex';       // Wyśrodkowanie zawartości
            pButton.style.alignItems = 'center';
            pButton.style.justifyContent = 'center';
            pButton.style.overflow = 'hidden';    // Ukrycie nadmiarowego kontentu
            console.log('Initialized audio element with ID:', audioId);
            console.log('Initialized play/pause button with ID:', pButtonId);

            // Play and Pause
            function playb() {
                // start music
                if (music.paused) {
                    music.play();
                    // remove play, add pause
                    pButton.classList.remove("play");
                    pButton.classList.add("pause");
                } else { // pause music
                    music.pause();
                    // remove pause, add play
                    pButton.classList.remove("pause");
                    pButton.classList.add("play");
                }
                console.log('Audio playback status:', music.paused ? 'Paused' : 'Playing');
            }

            // Gets audio file duration
            music.addEventListener("canplaythrough", function () {
                var duration = music.duration;
                console.log('Audio duration:', duration);
            }, false);

            // Dodajemy event listener do przycisku play/pause
            pButton.addEventListener('click', playb);

            console.log('Audio initialization completed.');
        }

// TWORZENIE KONTENERA FISZKI
        let fiszkaContainer = $('<div>').addClass('fiszka fiszka-' + fiszka.id);
    // Dodanie klasy parzysta, jeśli warunki są spełnione
    if (window.matchMedia("(max-width: 999px)").matches && lessonId2 % 2 === 0) {
        fiszkaContainer.addClass('parzysta');
    }
    // Tworzenie ikony krzyżyka
    let closeIcon = $('<span>')
        .addClass('close-icon')
    .html('&times;') // HTML kod krzyżyka
    .css({
        position: 'absolute',
        top: 'px', // Możesz dostosować pozycję
        right: '5px',
        width: '30px', // Szerokość kontenera
        height: '30px', // Wysokość kontenera (równa szerokości)
        cursor: 'pointer',
        color: 'red',
        fontSize: '40px', // Rozmiar fontu (zmniejszony dla lepszej czytelności)
        background: 'grey',
        border: '2px solid black',
        textAlign: 'center', // Wyrównanie tekstu w poziomie
        lineHeight: '30px', // Wyrównanie tekstu w pionie (równe wysokości kontenera)
        zIndex: 1000000
    });

    // Zdarzenie kliknięcia na krzyżyk
    closeIcon.on('click', function () {
        setTimeout(function () {
        removeFiszka(fiszka.id, lessonId2);
        }, 1000); // Opóźnienie w milisekundach (tu: 1 sekunda)
    });

    // Dodanie krzyżyka do fiszki
    fiszkaContainer.append(closeIcon);

        // DODANIE OBRAZKA
        const imgContainer = $('<div>').addClass('fiszka_img_container');
        if (Array.isArray(fiszka.img) && fiszka.img.length > 0) {
            fiszka.img.forEach((imgSrc, index) => {
                const imgElement = $('<img class="fiszka_img">').attr('src', imgSrc);
                imgContainer.append(imgElement);
                if (index > 0) {
                    imgElement.hide();
                }
            });
        } else if (typeof fiszka.img === 'string') {
            // Jeśli jest tylko jedno zdjęcie, dodajemy je do imgContainer dla każdej fiszki
            const imgElement = $('<img class="fiszka_img">').attr('src', fiszka.img);
            imgContainer.append(imgElement);
        }
        fiszkaContainer.append(imgContainer); //DODANIE OBRAZKA

        const selectedLikes = [];
        console.log('hej10', selectedLikes);

// Funkcja do obsługi kliknięcia na przycisk "likeButton"
        function handleLikeButtonClick(index) {
            const likeButton = $(this);
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            const selectedLike = likeButton.text();
            console.log('Zaktualizowano przycisk dla indeksu:', index);
            console.log('Aktualne wartości selectedLikes:', selectedLikes);
        }
        const likeButton = $('<a>').addClass('like').attr('href', '#');
        const likeText = $('<span>').text('Śmieszna historia');
        likeButton.append(likeText);
        fiszkaContainer.append(likeButton);

        // Tworzymy kontener opcji "like" i dodajemy opcje do kontenera
        const likeOptionsContainer = $('<div>').attr('id', 'likeOptionsContainer');
        const likeOption1 = createLikeOption('thumbsUp', '👍 Śmieszne');
        const likeOption2 = createLikeOption('heart', '❤️ Miłe');
        const likeOption3 = createLikeOption('star', '⭐ Pamiętliwe');
        likeOptionsContainer.append(likeOption1, likeOption2, likeOption3);

        // Dodajemy kontener opcji "like" do docelowego kontenera
        likeButton.append(likeOptionsContainer);

        // Ukrywamy kontener opcji "like"
        likeOptionsContainer.hide();

        // Obsługa zdarzenia hover na przycisku "like"
        likeButton.hover(function () {
            const buttonPosition = likeButton.offset();
            const buttonWidth = likeButton.outerWidth();

            // Pozycjonujemy kontener opcji "like" nad przyciskiem
            likeOptionsContainer.css({
                top: buttonPosition.top - likeOptionsContainer.outerHeight() - 10,
                left: buttonPosition.left + (buttonWidth / 2) - (likeOptionsContainer.outerWidth() / 2),
                backgroundColor: '#f0f0f0', // Dodajemy szary kolor tła
            }).fadeIn('fast');
        }, function () {
            // Ukrywamy kontener opcji "like" po zjechaniu z przycisku
            likeOptionsContainer.fadeOut('fast');
        });

// Funkcja do umieszczania ikony obok przycisku "story_button" w odpowiedniej fiszce
        function addLikeIconToStoryButton(index, like) {
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            if (storyButton.length === 0) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            // Tworzymy kontener dla ikony i dodajemy ikonę
            const iconContainer = $('<div>').addClass('likeIconContainer');
            const likeIcon = getLikeIcon(like);
            iconContainer.append(likeIcon);

            // Usuwamy wcześniej dodaną ikonę, jeśli istnieje
            storyButton.find('.likeIconContainer').remove();

            // Dodajemy kontener z ikoną do przycisku "story_button"
            storyButton.append(iconContainer);
        }

        function createLikeOption(like, text) {
            const likeOption = $('<div>').addClass('likeOption').attr('data-like', like).text(text);

            // Dodajemy efekt zmiany koloru na lekko ciemniejszy szary po najechaniu myszką na pojedynczą opcję "like"
            likeOption.hover(
                    function () {
                        likeOption.css('background-color', '#dcdcdc'); // Lekko ciemniejszy szary kolor tła dla opcji "like"
                    },
                    function () {
                        likeOption.css('background-color', ''); // Usuwamy styl, aby wrócić do domyślnego tła opcji "like"
                    }
            );

            let likeCounter = 0; // Dodajemy licznik polubień dla każdej opcji "like"

            const counterDiv = $('<div>').addClass('likeCounterDiv'); // Nowy div na licznik

            // Dodajemy ikonę do licznika
            const likeIcon = getLikeIcon(like);
            const iconContainer = $('<span>').addClass('likeIconContainer').append(likeIcon);
            counterDiv.append(iconContainer);

            const likeCounterSpan = $('<span>').addClass('likeCounter').text(` ${likeCounter} `);
            counterDiv.append(likeCounterSpan); // Licznik jest dodany po ikonie

            imgContainer.append(counterDiv); // Dodajemy licznik na zewnątrz kontenera przycisków

            likeOption.click(function (event) {
                event.preventDefault(); // Zapobiegamy domyślnej akcji przycisku

                // Inkrementujemy licznik polubień za każdym razem, gdy opcja "like" zostanie wybrana
                likeCounter++;
                likeCounterSpan.text(` ${likeCounter} `);

                const selectedLike = $(this).data('like');
                const selectedIcon = getLikeIcon(selectedLike);
                likeText.text(text);
                likeButton.removeClass('liked');
                addLikeIconToStoryButton(lastClickedIndex, selectedLike); // Dodaj ikonę do story_button na podstawie wybranej opcji "like"

                // Sprawdź, czy index już istnieje w tablicy
                const existingIndex = selectedLikes.findIndex(item => item.index === lastClickedIndex);
                if (existingIndex !== -1) {
                    // Jeśli index istnieje, zaktualizuj wartość
                    selectedLikes[existingIndex].like = selectedLike;
                } else {
                    // Jeśli index nie istnieje, dodaj nowy wpis
                    selectedLikes.push({index: lastClickedIndex, like: text}); // Dodaj tylko nazwę "like"
                }

                likeOptionsContainer.fadeOut('fast');
                saveSelectedLike(selectedLike, text); // Przekazujemy nazwę "like" i tekst do funkcji saveSelectedLike
            });

            return likeOption;
        }

// Funkcja do zapisywania wybranego "like"
        function saveSelectedLike(selectedLike, text) {
            // Tutaj możesz zapisać wybrany "like" w odpowiednim kontekście, np. wysłać go na serwer, zapisać w lokalnym magazynie itp.
            console.log('Wybrany like:', text);
            console.log('Tekst:', text);
            // Jeśli chcesz użyć go w innych miejscach, możesz przekazać go jako argument do innych funkcji lub zmiennych.
        }

        // Funkcja do pobierania ikony dla wybranego "like"
        function getLikeIcon(like) {
            let icon;
            switch (like) {
                case 'thumbsUp':
                    icon = $('<span class="likeIcon">👍</span>');
                    break;
                case 'heart':
                    icon = $('<span class="likeIcon">❤️</span>');
                    break;
                case 'star':
                    icon = $('<span class="likeIcon">⭐</span>');
                    break;
                default:
                    icon = $('<span class="likeIcon">👍</span>');
            }
            return icon;
        }

        const hashtagContainer = $('<a>').addClass('hashtag-container').attr('href', '#');
        fiszkaContainer.append(hashtagContainer);

        function showStory(index) {
            const currentFiszka = fiszkaContainer;

            // Ukrywamy wszystkie historie w tej konkretnej fiszce
            currentFiszka.find('.fiszka_story').hide();

            // Obsługa mnemoniki
            if (Array.isArray(fiszka.story)) {
                if (index >= 0 && index < fiszka.story.length) {
                    currentFiszka.find('.story-' + index).show();
                }
            } else if (fiszka.story) {
                currentFiszka.find('.story-0').show();
            }

            // Ukrywamy wszystkie obrazy
            currentFiszka.find('.fiszka_img').hide();

            // Obsługa obrazów
            let imgIndex; // Zmienna do przechowywania indeksu obrazka

            if (Array.isArray(fiszka.img)) {
                imgIndex = Math.min(index, fiszka.img.length - 1);
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img[imgIndex];
                console.log("Index obrazka:", imgIndex);
            } else {
                imgIndex = 0; // Ustawienie imgIndex na 0, gdy fiszka.img nie jest tablicą
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img;
                console.log("Index obrazka:", imgIndex);
            }

            lastClickedIndex = index;

            // Obsługa hashtagów
            const selectedCategoryIndex = index * 2;
            const value = fiszka.category1[selectedCategoryIndex];
            const hashtag = fiszka.category1[selectedCategoryIndex + 1];

            hashtagContainer.empty();
            hashtagContainer.text(`${value} #${hashtag}`);

            console.log('Calculated imgIndex:', imgIndex);

            return imgIndex;
        }

        function selectLikeButton(index) {
            console.log("Wybór likeButton dla indeksu:", index);
            const storyButton = $('.story_button').eq(index);
            if (!storyButton.length) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            const likeButton = storyButton.find('.like');
            likeText.find('span').remove();
            likeText.text('Śmieszna historia');

            // Sprawdź, czy index jest zawarty w tablicy selectedLikes
            const selectedLike = selectedLikes.find(item => item.index === index);
            if (selectedLike) {
                // Jeśli index istnieje w tablicy, ustaw ikonę przycisku na wartość z tablicy
                console.log("Wybrano like dla indeksu:", index, "- Like:", selectedLike.like);
                const selectedIcon = getLikeIcon(selectedLike.like); // Przekazujemy tylko nazwę ikony
                console.log('hej5', selectedIcon);
                likeText.html(selectedLike.like); // Ustawiamy ikonę
            } else {
                // Jeśli index nie istnieje, ustaw domyślny tekst
                console.log("Brak wyboru like dla indeksu:", index, "- Ustawianie domyślnego tekstu");
                likeButton.text('Śmieszna historia');
            }
        }
        // NIEZNACZĄCE WYJAŚNIENIE SŁOWA
        const sentenceDiv = $('<div>').attr('id', 'part');
        fiszka.sentence.forEach(word => {
            sentenceDiv.append($('<button>').text(word));
        });
        // Dodanie diva z przyciskami do kontenera fiszki
        fiszkaContainer.append(sentenceDiv);

        console.log('Przed utworzeniem wordDiv');
        const wordDiv = $('<div>').attr('id', 'word');
        const button = $('<button>').attr('id', 'storyone').html('<b>' + fiszka.desc + '</b>');
        const audio = $('<audio>').attr({
            id: 'music' + fiszka.id,
            preload: 'true'
        });
        const source = $('<source>').attr('src', fiszka.word);
        audio.append(source);
        const audioplayerDiv = $('<div>').attr('id', 'audioplayer' + fiszka.id).addClass('audioplayer'); // Dodano klasę 'audioplayer'
        const pButton = $('<button>').attr('id', 'pButton' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

        pButton.css({
            height: '60px',
            width: '60px',
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            float: 'left',
            outline: 'none',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden'
        });

        audioplayerDiv.append(pButton);
        wordDiv.append(button);
        wordDiv.append(audio);
        wordDiv.append(audioplayerDiv);
        fiszkaContainer.append(wordDiv);
        console.log('Po utworzeniu wordDiv');

// DODANIE MNEMOTECHNIKI
        if (Array.isArray(fiszka.story)) {
            // Jeśli story jest tablicą, iterujemy przez wszystkie jej elementy
            fiszka.story.forEach((story, index) => {
                const storyContainer = $('<div>').addClass('fiszka_story story-' + index).html(story);
                fiszkaContainer.append(storyContainer);
                console.log("Dodano story: ", story);  // Debugowanie
            });
        } else if (fiszka.story) {
            // Jeśli story jest pojedynczym stringiem, dodajemy go bezpośrednio
            const storyContainer = $('<div>').addClass('fiszka_story story-0').html(fiszka.story);
            fiszkaContainer.append(storyContainer);
            console.log("Dodano story: ", fiszka.story);  // Debugowanie
        }
        console.log('Przed utworzeniem wordDiv');

// Utworzenie reszty elementów zgodnie z istniejącym kodem
        const wordDiv2 = $('<div>').attr('id', 'word2');
        const audio2 = $('<audio>').attr({
            id: 'music2' + fiszka.id,
            preload: 'true'
        });
        const source2 = $('<source>').attr('src', fiszka.word);
        audio2.append(source2);
        const audioplayerDiv2 = $('<div>').attr('id', 'audioplayer2' + fiszka.id).addClass('audioplayer2'); // Dodano klasę 'audioplayer'
        const pButton2 = $('<button>').attr('id', 'pButton2' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

// Utworzenie elementów za pomocą jQuery
        const timelineDiv = $('<div>').attr('id', 'timeline' + fiszka.id);
        const playheadDiv = $('<div>').attr('id', 'playhead' + fiszka.id);

// Dodanie playhead do timeline
        timelineDiv.append(playheadDiv);

// Dodanie elementów do odpowiednich kontenerów
        audioplayerDiv.append(pButton2);
        wordDiv2.append(audio2);
        wordDiv2.append(audioplayerDiv2);
        wordDiv2.append(timelineDiv); // Dodano timeline do wordDiv
        fiszkaContainer.append(wordDiv2);

        console.log('Po utworzeniu wordDiv');
        // Zdefiniuj zmienną początkową na poziomie wyższym
        let initialSpecificLesson2Ref;
        let specificLesson2Ref;
        let lastClickedIndex = null;
        let lastApprovedIndex = null; // Zmienna do przechowywania ostatnio zatwierdzonego indeksu
        let approvedIndexes = []; // Tablica przechowująca zatwierdzone indeksy
        let approvedColors = [];

// DODANIE PRZYCISKÓW
        if (Array.isArray(fiszka.category1)) {
            const storyButtonContainer = $('<div>'); // Kontener na przyciski
            const randomIndex = Math.floor(Math.random() * fiszka.category1.length / 2);
            let lastClickedButton; // Zmienna do przechowywania ostatnio klikniętego przycisku w danej fiszce

            fiszka.category1.slice(0, 5).forEach((category1, index) => {
                const valueIndex = index * 2; // Indeks wartości w tablicy, zaczynając od 0
                const hashtagIndex = valueIndex + 1; // Indeks hashtagu w tablicy

                const value = fiszka.category1[valueIndex];
                const hashtag = fiszka.category1[hashtagIndex];

                const displayText = `${value} #${hashtag}`;

                const storyButton = $('<button>')
                        .text(displayText)
                        .addClass('story_button')
                        .click(function () {
                            showStory(index);
                            lastClickedIndex = index;

                            // Usuwamy zieloną klasę tylko z poprzedniego przycisku w danej fiszce
                            if (lastClickedButton) {
                                lastClickedButton.removeClass('green-button');
                            }

                            // Usuwamy klasę imgIndex z poprzedniego przycisku w danej fiszce
                            $('.story_button').removeClass((index, className) => (className.match(/imgIndex-\d+/g) || []).join(' '));
                            // Dodajemy klasę imgIndexNull do przycisków, które nie zostały jeszcze zatwierdzone
                            $('.fiszka').addClass('imgIndexNull').removeClass('imgIndex-0 imgIndex-1 imgIndex-2 imgIndex-3 imgIndex-4 ');

                            // Dodajemy zieloną klasę tylko dla aktualnie klikniętego przycisku w danej fiszce
                            $(this).addClass('green-button');
                            $('.story_button').removeClass('active-button');
                            $(this).addClass('active-button');
                            $('.story_button').each(function (index) {
                                if ($(this).hasClass('orange-button')) {
                                    $(this).removeClass('green-button');
                                    $(this).addClass('orange-button');
                                }
                            });

                            // Jeśli przycisk został wcześniej zatwierdzony, przywróć jego zatwierdzoną klasę
                            if (approvedIndexes.includes(lastClickedIndex)) {
                                fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
                            }

                            // Zapisujemy ostatnio kliknięty przycisk w danej fiszce
                            lastClickedButton = $(this);
                            handleLikeButtonClick();
                        });

                if (index === randomIndex) {
                    // Sprawdzamy, czy fiszka.img jest tablicą czy pojedynczą wartością
                    if (Array.isArray(fiszka.img)) {
                        newImgIndex = Math.min(index, fiszka.img.length - 1); // Aktualizacja zmiennej globalnej imgIndex
                        specificLesson2Ref = fiszka.img[newImgIndex];
                        console.log('hej432', specificLesson2Ref);
                    } else if (fiszka.img) {
                        newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
                        specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
                        console.log('hej432', specificLesson2Ref);
                    }
                    initialSpecificLesson2Ref = specificLesson2Ref;
                    console.log('Hej7', specificLesson2Ref);
                    storyButton.addClass('green-button');
                    lastClickedButton = storyButton;
                    lastApprovedIndex = index; // Ustaw ostatnio zatwierdzony indeks na indeks losowego przycisku
                }

                // Dodaj typ "like" dla tej fiszki do tablicy
                storyButtonContainer.append(storyButton);
            });

            fiszkaContainer.append(storyButtonContainer);

            // WYWOŁANIE TABLICY
            showStory(randomIndex);
            console.log(randomIndex);

            // Użycie specificLesson2Ref po załadowaniu strony
            console.log("Początkowy specificLesson2Ref:", initialSpecificLesson2Ref);

        } else if (fiszka.category1) {
            // Jeśli fiszka.category1 nie jest tablicą
            newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
            specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
            initialSpecificLesson2Ref = specificLesson2Ref;
            console.log('Hej7', specificLesson2Ref);

            // Stwórz pojedynczy przycisk dla pojedynczej wartości category1
            const displayText = `${fiszka.category1} #${fiszka.category1}`;
            const storyButton = $('<button>')
                    .text(displayText)
                    .addClass('story_button2 green-button') // Od razu przypisz zieloną klasę
                    .click(function () {
                        showStory(0); // Przekazujemy 0 jako indeks, ponieważ jest to pojedyncza wartość
                        lastClickedIndex = 0;

                        // Zapisujemy ostatnio kliknięty przycisk
                        lastClickedButton = $(this);
                        handleLikeButtonClick();
                    });

            fiszkaContainer.append(storyButton);
            lastClickedButton = storyButton;
            lastApprovedIndex = 0; // Ustaw ostatnio zatwierdzony indeks na 0

            // WYWOŁANIE POJEDYNCZEJ HISTORII
            showStory(0);
            console.log("Pojedyncza wartość dla category1, specificLesson2Ref:", specificLesson2Ref);
        }
        $('.fiszka_button_trening').click(function () {
            // Dodaj klasę pomarańczową tylko dla przycisku zatwierdzonego
            $('.story_button').each(function (index) {
                if ($(this).hasClass('green-button')) {
                    $(this).removeClass('green-button');
                    $(this).addClass('orange-button');
                }
            });
        });
        console.log('hej555ax', lessons2b[2]);
// DODANIE PRZYCISKU TRENING
        fiszkaContainer.append($('<button>').text('TRENING').addClass('fiszka_button fiszka_button_trening').click(function () {

            activateFiszka(fiszka.id, false);

            let id = fiszka.id;
            let parametr = '';

            // Sprawdzenie, czy idFiszki jest tablicą
            if (Array.isArray(fiszka.id)) {
                id = fiszka.id[0];         // Pierwszy element tablicy jako id
                parametr = fiszka.id[1] || ''; // Drugi element tablicy jako parametr, jeśli istnieje
            }

            // Tworzenie selektora na podstawie id i parametru
            const className = `fiszka-${id}\\,${parametr}`;
            const selector = `.${className}`;
            console.log('hej201', parametr);
            let first = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[0]) {
                first = true;
                console.log('hej200', first);

            }
            let second = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[1]) {
                second = true;
                console.log('hej200', second);

            }
            let third = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[2]) {
                third = true;
                console.log('hej200', third);

            }

            console.log("Trening clicked on fiszka nr " + fiszka.id);
            console.log("lessonId2:", lessonId2);
            console.log("nazwa", lessons2b[2]);
            // Wyswietlenie danej wartości img dla danej fiszka.id
            const specificLesson2 = specificLesson2Ref || initialSpecificLesson2Ref;
            console.log("img dla fiszki o id", fiszka.id, ":", specificLesson2);
            specificLesson2Ref = fiszka.img;
            // Znajdź indeks dla danej fiszki w tablicy lessons2[lessonId2]
            console.log('story55', specificLesson2Ref);
            // Używamy lastClickedIndex zamiast index
            imgIndex = showStory(lastClickedIndex); // Wywołanie funkcji showStory i zapisanie zwróconego indeksu obrazka
            console.log('działa', specificLesson2Ref);
            aktywujObrazek(first, second, third, specificLesson2, 'obrazek-container2b', true, fiszka, imgIndex); // Przekazanie imgIndex do funkcji aktywujObrazek
            // Dodajemy zatwierdzony indeks do tablicy
            approvedIndexes.push(lastClickedIndex);
            console.log(approvedIndexes);

            // Dodanie zatwierdzonej klasy imgIndex do fiszkaContainer po kliknięciu przycisku "TRENING"
            fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
        }));

        fiszkaContainer.append($('<button>').text('ZNAM').addClass('fiszka_button fiszka_button_znam').click(function () {
            console.log("Znam clicked on fiszka nr " + fiszka.id);
            activateFiszka(fiszka.id, true);
        }));

        // WYWOŁANIE HASHTAGU
        function updateButtonName(buttonName, fiszkaContainer) {
            // Usuń poprzednią nazwę, jeśli istnieje
            fiszkaContainer.find('.fiszka_button_name').remove();

            // Ustaw nazwę w prawym dolnym rogu fiszki
            const fiszkaButtonNameContainer = $('<div>').addClass('fiszka_button_name').text(buttonName);
            fiszkaContainer.append(fiszkaButtonNameContainer);
        }
        // Dodanie kontenera fiszki do body
        $(`.image-container4[data-lesson="${lessonId2}"]`).append(fiszkaContainer);
        console.log(`Generated fiszka block for ID: [${fiszka.id.join(', ')}]`);
        initAudio(fiszka.id);
    });
}
function generateFiszkaBlock3(fiszka, lessonId2) {
    console.log('hej555x', fiszka.id);
$('.grid-container .image-container3').remove();
$('.grid-container .image-container4').remove();
    console.log(`Generating: [${fiszka}]`);

    // Tworzenie kontenera fiszki

    $(document).ready(function () {

        function initAudio(fiszkaId) {
            var audioId = 'music' + fiszkaId;
            var pButtonId = 'pButton' + fiszkaId;

            var music = document.getElementById(audioId);
            var pButton = document.getElementById(pButtonId);
            // Dodajemy style bezpośrednio w kodzie JavaScript
            if (window.matchMedia("(max-width: 999px)").matches) {
                pButton.style.height = '100px';  // Zwiększenie wysokości
                pButton.style.width = '100px';   // Zwiększenie szerokości
            } else {
                pButton.style.height = '60px';  // Zwiększenie wysokości
                pButton.style.width = '60px';   // Zwiększenie szerokości
            }
            pButton.style.border = 'none';   // Usunięcie ramki
            pButton.style.backgroundSize = '80%';  // Rozmiar obrazka tła
            pButton.style.backgroundRepeat = 'no-repeat';
            pButton.style.backgroundPosition = 'center';
            pButton.style.borderRadius = '8px';   // Zaokrąglenie rogów
            pButton.style.outline = 'none';       // Usunięcie obramowania
            pButton.style.display = 'flex';       // Wyśrodkowanie zawartości
            pButton.style.alignItems = 'center';
            pButton.style.justifyContent = 'center';
            pButton.style.overflow = 'hidden';    // Ukrycie nadmiarowego kontentu
            console.log('Initialized audio element with ID:', audioId);
            console.log('Initialized play/pause button with ID:', pButtonId);

            // Play and Pause
            function playb() {
                // start music
                if (music.paused) {
                    music.play();
                    // remove play, add pause
                    pButton.classList.remove("play");
                    pButton.classList.add("pause");
                } else { // pause music
                    music.pause();
                    // remove pause, add play
                    pButton.classList.remove("pause");
                    pButton.classList.add("play");
                }
                console.log('Audio playback status:', music.paused ? 'Paused' : 'Playing');
            }

            // Gets audio file duration
            music.addEventListener("canplaythrough", function () {
                var duration = music.duration;
                console.log('Audio duration:', duration);
            }, false);

            // Dodajemy event listener do przycisku play/pause
            pButton.addEventListener('click', playb);

            console.log('Audio initialization completed.');
        }
// TWORZENIE KONTENERA FISZKI
        let fiszkaContainer = $('<div>').addClass('fiszka5 fiszka-' + fiszka.id);


console.log('Hej4442', fiszkaContainer);
        // DODANIE OBRAZKA
        const imgContainer = $('<div>').addClass('fiszka_img_container');
        if (Array.isArray(fiszka.img) && fiszka.img.length > 0) {
            fiszka.img.forEach((imgSrc, index) => {
                const imgElement = $('<img class="fiszka_img">').attr('src', imgSrc);
                imgContainer.append(imgElement);
                if (index > 0) {
                    imgElement.hide();
                }
            });
        } else if (typeof fiszka.img === 'string') {
            // Jeśli jest tylko jedno zdjęcie, dodajemy je do imgContainer dla każdej fiszki
            const imgElement = $('<img class="fiszka_img">').attr('src', fiszka.img);
            imgContainer.append(imgElement);
        }
        fiszkaContainer.append(imgContainer); //DODANIE OBRAZKA

        const selectedLikes = [];
        console.log('hej10', selectedLikes);

// Funkcja do obsługi kliknięcia na przycisk "likeButton"
        function handleLikeButtonClick(index) {
            const likeButton = $(this);
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            const selectedLike = likeButton.text();
            console.log('Zaktualizowano przycisk dla indeksu:', index);
            console.log('Aktualne wartości selectedLikes:', selectedLikes);
        }
        const likeButton = $('<a>').addClass('like').attr('href', '#');
        const likeText = $('<span>').text('Śmieszna historia');
        likeButton.append(likeText);
        fiszkaContainer.append(likeButton);

        // Tworzymy kontener opcji "like" i dodajemy opcje do kontenera
        const likeOptionsContainer = $('<div>').attr('id', 'likeOptionsContainer');
        const likeOption1 = createLikeOption('thumbsUp', '👍 Śmieszne');
        const likeOption2 = createLikeOption('heart', '❤️ Miłe');
        const likeOption3 = createLikeOption('star', '⭐ Pamiętliwe');
        likeOptionsContainer.append(likeOption1, likeOption2, likeOption3);

        // Dodajemy kontener opcji "like" do docelowego kontenera
        likeButton.append(likeOptionsContainer);

        // Ukrywamy kontener opcji "like"
        likeOptionsContainer.hide();

        // Obsługa zdarzenia hover na przycisku "like"
        likeButton.hover(function () {
            const buttonPosition = likeButton.offset();
            const buttonWidth = likeButton.outerWidth();

            // Pozycjonujemy kontener opcji "like" nad przyciskiem
            likeOptionsContainer.css({
                top: buttonPosition.top - likeOptionsContainer.outerHeight() - 10,
                left: buttonPosition.left + (buttonWidth / 2) - (likeOptionsContainer.outerWidth() / 2),
                backgroundColor: '#f0f0f0', // Dodajemy szary kolor tła
            }).fadeIn('fast');
        }, function () {
            // Ukrywamy kontener opcji "like" po zjechaniu z przycisku
            likeOptionsContainer.fadeOut('fast');
        });

// Funkcja do umieszczania ikony obok przycisku "story_button" w odpowiedniej fiszce
        function addLikeIconToStoryButton(index, like) {
            const storyButton = fiszkaContainer.find('.story_button').eq(index);
            if (storyButton.length === 0) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            // Tworzymy kontener dla ikony i dodajemy ikonę
            const iconContainer = $('<div>').addClass('likeIconContainer');
            const likeIcon = getLikeIcon(like);
            iconContainer.append(likeIcon);

            // Usuwamy wcześniej dodaną ikonę, jeśli istnieje
            storyButton.find('.likeIconContainer').remove();

            // Dodajemy kontener z ikoną do przycisku "story_button"
            storyButton.append(iconContainer);
        }

        function createLikeOption(like, text) {
            const likeOption = $('<div>').addClass('likeOption').attr('data-like', like).text(text);

            // Dodajemy efekt zmiany koloru na lekko ciemniejszy szary po najechaniu myszką na pojedynczą opcję "like"
            likeOption.hover(
                    function () {
                        likeOption.css('background-color', '#dcdcdc'); // Lekko ciemniejszy szary kolor tła dla opcji "like"
                    },
                    function () {
                        likeOption.css('background-color', ''); // Usuwamy styl, aby wrócić do domyślnego tła opcji "like"
                    }
            );

            let likeCounter = 0; // Dodajemy licznik polubień dla każdej opcji "like"

            const counterDiv = $('<div>').addClass('likeCounterDiv'); // Nowy div na licznik

            // Dodajemy ikonę do licznika
            const likeIcon = getLikeIcon(like);
            const iconContainer = $('<span>').addClass('likeIconContainer').append(likeIcon);
            counterDiv.append(iconContainer);

            const likeCounterSpan = $('<span>').addClass('likeCounter').text(` ${likeCounter} `);
            counterDiv.append(likeCounterSpan); // Licznik jest dodany po ikonie

            imgContainer.append(counterDiv); // Dodajemy licznik na zewnątrz kontenera przycisków

            likeOption.click(function (event) {
                event.preventDefault(); // Zapobiegamy domyślnej akcji przycisku

                // Inkrementujemy licznik polubień za każdym razem, gdy opcja "like" zostanie wybrana
                likeCounter++;
                likeCounterSpan.text(` ${likeCounter} `);

                const selectedLike = $(this).data('like');
                const selectedIcon = getLikeIcon(selectedLike);
                likeText.text(text);
                likeButton.removeClass('liked');
                addLikeIconToStoryButton(lastClickedIndex, selectedLike); // Dodaj ikonę do story_button na podstawie wybranej opcji "like"

                // Sprawdź, czy index już istnieje w tablicy
                const existingIndex = selectedLikes.findIndex(item => item.index === lastClickedIndex);
                if (existingIndex !== -1) {
                    // Jeśli index istnieje, zaktualizuj wartość
                    selectedLikes[existingIndex].like = selectedLike;
                } else {
                    // Jeśli index nie istnieje, dodaj nowy wpis
                    selectedLikes.push({index: lastClickedIndex, like: text}); // Dodaj tylko nazwę "like"
                }

                likeOptionsContainer.fadeOut('fast');
                saveSelectedLike(selectedLike, text); // Przekazujemy nazwę "like" i tekst do funkcji saveSelectedLike
            });

            return likeOption;
        }

// Funkcja do zapisywania wybranego "like"
        function saveSelectedLike(selectedLike, text) {
            // Tutaj możesz zapisać wybrany "like" w odpowiednim kontekście, np. wysłać go na serwer, zapisać w lokalnym magazynie itp.
            console.log('Wybrany like:', text);
            console.log('Tekst:', text);
            // Jeśli chcesz użyć go w innych miejscach, możesz przekazać go jako argument do innych funkcji lub zmiennych.
        }

        // Funkcja do pobierania ikony dla wybranego "like"
        function getLikeIcon(like) {
            let icon;
            switch (like) {
                case 'thumbsUp':
                    icon = $('<span class="likeIcon">👍</span>');
                    break;
                case 'heart':
                    icon = $('<span class="likeIcon">❤️</span>');
                    break;
                case 'star':
                    icon = $('<span class="likeIcon">⭐</span>');
                    break;
                default:
                    icon = $('<span class="likeIcon">👍</span>');
            }
            return icon;
        }

        const hashtagContainer = $('<a>').addClass('hashtag-container').attr('href', '#');
        fiszkaContainer.append(hashtagContainer);

        function showStory(index) {
            const currentFiszka = fiszkaContainer;

            // Ukrywamy wszystkie historie w tej konkretnej fiszce
            currentFiszka.find('.fiszka_story').hide();

            // Obsługa mnemoniki
            if (Array.isArray(fiszka.story)) {
                if (index >= 0 && index < fiszka.story.length) {
                    currentFiszka.find('.story-' + index).show();
                }
            } else if (fiszka.story) {
                currentFiszka.find('.story-0').show();
            }

            // Ukrywamy wszystkie obrazy
            currentFiszka.find('.fiszka_img').hide();

            // Obsługa obrazów
            let imgIndex; // Zmienna do przechowywania indeksu obrazka

            if (Array.isArray(fiszka.img)) {
                imgIndex = Math.min(index, fiszka.img.length - 1);
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img[imgIndex];
                console.log("Index obrazka:", imgIndex);
            } else {
                imgIndex = 0; // Ustawienie imgIndex na 0, gdy fiszka.img nie jest tablicą
                currentFiszka.find('.fiszka_img').eq(imgIndex).show();
                specificLesson2Ref = fiszka.img;
                console.log("Index obrazka:", imgIndex);
            }

            lastClickedIndex = index;

            // Obsługa hashtagów
            const selectedCategoryIndex = index * 2;
            const value = fiszka.category1[selectedCategoryIndex];
            const hashtag = fiszka.category1[selectedCategoryIndex + 1];

            hashtagContainer.empty();
            hashtagContainer.text(`${value} #${hashtag}`);

            console.log('Calculated imgIndex:', imgIndex);

            return imgIndex;
        }

        function selectLikeButton(index) {
            console.log("Wybór likeButton dla indeksu:", index);
            const storyButton = $('.story_button').eq(index);
            if (!storyButton.length) {
                console.error('Nie znaleziono przycisku dla indeksu:', index);
                return;
            }

            const likeButton = storyButton.find('.like');
            likeText.find('span').remove();
            likeText.text('Śmieszna historia');

            // Sprawdź, czy index jest zawarty w tablicy selectedLikes
            const selectedLike = selectedLikes.find(item => item.index === index);
            if (selectedLike) {
                // Jeśli index istnieje w tablicy, ustaw ikonę przycisku na wartość z tablicy
                console.log("Wybrano like dla indeksu:", index, "- Like:", selectedLike.like);
                const selectedIcon = getLikeIcon(selectedLike.like); // Przekazujemy tylko nazwę ikony
                console.log('hej5', selectedIcon);
                likeText.html(selectedLike.like); // Ustawiamy ikonę
            } else {
                // Jeśli index nie istnieje, ustaw domyślny tekst
                console.log("Brak wyboru like dla indeksu:", index, "- Ustawianie domyślnego tekstu");
                likeButton.text('Śmieszna historia');
            }
        }
        // NIEZNACZĄCE WYJAŚNIENIE SŁOWA
        const sentenceDiv = $('<div>').attr('id', 'part');
        fiszka.sentence.forEach(word => {
            sentenceDiv.append($('<button>').text(word));
        });
        // Dodanie diva z przyciskami do kontenera fiszki
        fiszkaContainer.append(sentenceDiv);

        console.log('Przed utworzeniem wordDiv');
        const wordDiv = $('<div>').attr('id', 'word');
        const button = $('<button>').attr('id', 'storyone').html('<b>' + fiszka.desc + '</b>');
        const audio = $('<audio>').attr({
            id: 'music' + fiszka.id,
            preload: 'true'
        });
        const source = $('<source>').attr('src', fiszka.word);
        audio.append(source);
        const audioplayerDiv = $('<div>').attr('id', 'audioplayer' + fiszka.id).addClass('audioplayer'); // Dodano klasę 'audioplayer'
        const pButton = $('<button>').attr('id', 'pButton' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

        pButton.css({
            height: '60px',
            width: '60px',
            backgroundSize: 'cover',
            backgroundRepeat: 'no-repeat',
            backgroundPosition: 'center',
            float: 'left',
            outline: 'none',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            overflow: 'hidden'
        });

        audioplayerDiv.append(pButton);
        wordDiv.append(button);
        wordDiv.append(audio);
        wordDiv.append(audioplayerDiv);
        fiszkaContainer.append(wordDiv);
        console.log('Po utworzeniu wordDiv');

// DODANIE MNEMOTECHNIKI
        if (Array.isArray(fiszka.story)) {
            // Jeśli story jest tablicą, iterujemy przez wszystkie jej elementy
            fiszka.story.forEach((story, index) => {
                const storyContainer = $('<div>').addClass('fiszka_story story-' + index).html(story);
                fiszkaContainer.append(storyContainer);
                console.log("Dodano story: ", story);  // Debugowanie
            });
        } else if (fiszka.story) {
            // Jeśli story jest pojedynczym stringiem, dodajemy go bezpośrednio
            const storyContainer = $('<div>').addClass('fiszka_story story-0').html(fiszka.story);
            fiszkaContainer.append(storyContainer);
            console.log("Dodano story: ", fiszka.story);  // Debugowanie
        }
        console.log('Przed utworzeniem wordDiv');

// Utworzenie reszty elementów zgodnie z istniejącym kodem
        const wordDiv2 = $('<div>').attr('id', 'word2');
        const audio2 = $('<audio>').attr({
            id: 'music2' + fiszka.id,
            preload: 'true'
        });
        const source2 = $('<source>').attr('src', fiszka.word);
        audio2.append(source2);
        const audioplayerDiv2 = $('<div>').attr('id', 'audioplayer2' + fiszka.id).addClass('audioplayer2'); // Dodano klasę 'audioplayer'
        const pButton2 = $('<button>').attr('id', 'pButton2' + fiszka.id).addClass('pButton play').click(function () {
            console.log('playb called for fiszka.id:', fiszka.id);
            window['playb' + fiszka.id]();
        });

// Utworzenie elementów za pomocą jQuery
        const timelineDiv = $('<div>').attr('id', 'timeline' + fiszka.id);
        const playheadDiv = $('<div>').attr('id', 'playhead' + fiszka.id);

// Dodanie playhead do timeline
        timelineDiv.append(playheadDiv);

// Dodanie elementów do odpowiednich kontenerów
        audioplayerDiv.append(pButton2);
        wordDiv2.append(audio2);
        wordDiv2.append(audioplayerDiv2);
        wordDiv2.append(timelineDiv); // Dodano timeline do wordDiv
        fiszkaContainer.append(wordDiv2);

        console.log('Po utworzeniu wordDiv');
        // Zdefiniuj zmienną początkową na poziomie wyższym
        let initialSpecificLesson2Ref;
        let specificLesson2Ref;
        let lastClickedIndex = null;
        let lastApprovedIndex = null; // Zmienna do przechowywania ostatnio zatwierdzonego indeksu
        let approvedIndexes = []; // Tablica przechowująca zatwierdzone indeksy
        let approvedColors = [];

// DODANIE PRZYCISKÓW
        if (Array.isArray(fiszka.category1)) {
            const storyButtonContainer = $('<div>'); // Kontener na przyciski
            const randomIndex = Math.floor(Math.random() * fiszka.category1.length / 2);
            let lastClickedButton; // Zmienna do przechowywania ostatnio klikniętego przycisku w danej fiszce

            fiszka.category1.slice(0, 5).forEach((category1, index) => {
                const valueIndex = index * 2; // Indeks wartości w tablicy, zaczynając od 0
                const hashtagIndex = valueIndex + 1; // Indeks hashtagu w tablicy

                const value = fiszka.category1[valueIndex];
                const hashtag = fiszka.category1[hashtagIndex];

                const displayText = `${value} #${hashtag}`;

                const storyButton = $('<button>')
                        .text(displayText)
                        .addClass('story_button')
                        .click(function () {
                            showStory(index);
                            lastClickedIndex = index;

                            // Usuwamy zieloną klasę tylko z poprzedniego przycisku w danej fiszce
                            if (lastClickedButton) {
                                lastClickedButton.removeClass('green-button');
                            }

                            // Usuwamy klasę imgIndex z poprzedniego przycisku w danej fiszce
                            $('.story_button').removeClass((index, className) => (className.match(/imgIndex-\d+/g) || []).join(' '));
                            // Dodajemy klasę imgIndexNull do przycisków, które nie zostały jeszcze zatwierdzone
                            $('.fiszka').addClass('imgIndexNull').removeClass('imgIndex-0 imgIndex-1 imgIndex-2 imgIndex-3 imgIndex-4 ');

                            // Dodajemy zieloną klasę tylko dla aktualnie klikniętego przycisku w danej fiszce
                            $(this).addClass('green-button');
                            $('.story_button').removeClass('active-button');
                            $(this).addClass('active-button');
                            $('.story_button').each(function (index) {
                                if ($(this).hasClass('orange-button')) {
                                    $(this).removeClass('green-button');
                                    $(this).addClass('orange-button');
                                }
                            });

                            // Jeśli przycisk został wcześniej zatwierdzony, przywróć jego zatwierdzoną klasę
                            if (approvedIndexes.includes(lastClickedIndex)) {
                                fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
                            }

                            // Zapisujemy ostatnio kliknięty przycisk w danej fiszce
                            lastClickedButton = $(this);
                            handleLikeButtonClick();
                        });

                if (index === randomIndex) {
                    // Sprawdzamy, czy fiszka.img jest tablicą czy pojedynczą wartością
                    if (Array.isArray(fiszka.img)) {
                        newImgIndex = Math.min(index, fiszka.img.length - 1); // Aktualizacja zmiennej globalnej imgIndex
                        specificLesson2Ref = fiszka.img[newImgIndex];
                        console.log('hej432', specificLesson2Ref);
                    } else if (fiszka.img) {
                        newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
                        specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
                        console.log('hej432', specificLesson2Ref);
                    }
                    initialSpecificLesson2Ref = specificLesson2Ref;
                    console.log('Hej7', specificLesson2Ref);
                    storyButton.addClass('green-button');
                    lastClickedButton = storyButton;
                    lastApprovedIndex = index; // Ustaw ostatnio zatwierdzony indeks na indeks losowego przycisku
                }

                // Dodaj typ "like" dla tej fiszki do tablicy
                storyButtonContainer.append(storyButton);
            });

            fiszkaContainer.append(storyButtonContainer);

            // WYWOŁANIE TABLICY
            showStory(randomIndex);
            console.log(randomIndex);

            // Użycie specificLesson2Ref po załadowaniu strony
            console.log("Początkowy specificLesson2Ref:", initialSpecificLesson2Ref);

        } else if (fiszka.category1) {
            // Jeśli fiszka.category1 nie jest tablicą
            newImgIndex = 0; // Przypisanie domyślnego indeksu dla pojedynczego obrazka
            specificLesson2Ref = fiszka.img; // Przypisanie pojedynczej wartości do specificLesson2Ref
            initialSpecificLesson2Ref = specificLesson2Ref;
            console.log('Hej7', specificLesson2Ref);

            // Stwórz pojedynczy przycisk dla pojedynczej wartości category1
            const displayText = `${fiszka.category1} #${fiszka.category1}`;
            const storyButton = $('<button>')
                    .text(displayText)
                    .addClass('story_button2 green-button') // Od razu przypisz zieloną klasę
                    .click(function () {
                        showStory(0); // Przekazujemy 0 jako indeks, ponieważ jest to pojedyncza wartość
                        lastClickedIndex = 0;

                        // Zapisujemy ostatnio kliknięty przycisk
                        lastClickedButton = $(this);
                        handleLikeButtonClick();
                    });

            fiszkaContainer.append(storyButton);
            lastClickedButton = storyButton;
            lastApprovedIndex = 0; // Ustaw ostatnio zatwierdzony indeks na 0

            // WYWOŁANIE POJEDYNCZEJ HISTORII
            showStory(0);
            console.log("Pojedyncza wartość dla category1, specificLesson2Ref:", specificLesson2Ref);
        }
        $('.fiszka_button_trening').click(function () {
            // Dodaj klasę pomarańczową tylko dla przycisku zatwierdzonego
            $('.story_button').each(function (index) {
                if ($(this).hasClass('green-button')) {
                    $(this).removeClass('green-button');
                    $(this).addClass('orange-button');
                }
            });
        });
        console.log('hej555ax', lessons2b[2]);
// DODANIE PRZYCISKU TRENING
        fiszkaContainer.append($('<button>').text('TRENING').addClass('fiszka_button fiszka_button_trening').click(function () {

            activateFiszka(fiszka.id, false);

            let id = fiszka.id;
            let parametr = '';

            // Sprawdzenie, czy idFiszki jest tablicą
            if (Array.isArray(fiszka.id)) {
                id = fiszka.id[0];         // Pierwszy element tablicy jako id
                parametr = fiszka.id[1] || ''; // Drugi element tablicy jako parametr, jeśli istnieje
            }

            // Tworzenie selektora na podstawie id i parametru
            const className = `fiszka-${id}\\,${parametr}`;
            const selector = `.${className}`;
            console.log('hej201', parametr);
            let first = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[0]) {
                first = true;
                console.log('hej200', first);

            }
            let second = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[1]) {
                second = true;
                console.log('hej200', second);

            }
            let third = false;
            // Jeśli parametr jest równy lessons2b[0], uruchom aktywujObrazek
            if (parametr === lessons2b[2]) {
                third = true;
                console.log('hej200', third);

            }

            console.log("Trening clicked on fiszka nr " + fiszka.id);
            console.log("lessonId2:", lessonId2);
            console.log("nazwa", lessons2b[2]);
            // Wyswietlenie danej wartości img dla danej fiszka.id
            const specificLesson2 = specificLesson2Ref || initialSpecificLesson2Ref;
            console.log("img dla fiszki o id", fiszka.id, ":", specificLesson2);
            specificLesson2Ref = fiszka.img;
            // Znajdź indeks dla danej fiszki w tablicy lessons2[lessonId2]
            console.log('story55', specificLesson2Ref);
            // Używamy lastClickedIndex zamiast index
            imgIndex = showStory(lastClickedIndex); // Wywołanie funkcji showStory i zapisanie zwróconego indeksu obrazka
            console.log('działa', specificLesson2Ref);
            aktywujObrazek(first, second, third, specificLesson2, 'obrazek-container2b', true, fiszka, imgIndex); // Przekazanie imgIndex do funkcji aktywujObrazek
            // Dodajemy zatwierdzony indeks do tablicy
            approvedIndexes.push(lastClickedIndex);
            console.log(approvedIndexes);

            // Dodanie zatwierdzonej klasy imgIndex do fiszkaContainer po kliknięciu przycisku "TRENING"
            fiszkaContainer.addClass('imgIndex-' + lastClickedIndex);
        }));

        fiszkaContainer.append($('<button>').text('ZNAM').addClass('fiszka_button fiszka_button_znam').click(function () {
            console.log("Znam clicked on fiszka nr " + fiszka.id);
            activateFiszka(fiszka.id, true);
        }));

        // Dodanie kontenera fiszki do body
        $('.grid-container').append(fiszkaContainer);
        console.log(`Generated2: [${fiszka}]`);
        initAudio(fiszka.id);
    });
}



function getRandomFiszki(fiszkiArray, n) {
    const shuffledFiszki = fiszkiArray.sort(() => Math.random() - 0.5);
    return shuffledFiszki.slice(0, n);
}


function showFiszki() {
    const selectedFiszki = getRandomFiszki(fiszki, 18);
    // Wygeneruj bloki kodu dla wybranych fiszek
    selectedFiszki.forEach(fiszka => {
        console.log(fiszka);
        generateFiszkaBlock(fiszka);
    });
}
function removeFiszka(idFiszki, lessonId2) {
    let id = idFiszki;
    let parametr = '';

    if (Array.isArray(idFiszki)) {
        // Połącz wartości z tablicy id w jeden ciąg znaków oddzielony przecinkami
        id = idFiszki.slice(0, 3).join(',');
        // Obsługa ewentualnego dodatkowego parametru (np. czwartego elementu w tablicy)
        parametr = idFiszki.length > 3 ? idFiszki[3] : '';
    }

    // Tworzenie klasy CSS z odpowiednim formatowaniem (poprawione usunięcie przecinków w CSS)
    const className = `fiszka-${id}${parametr ? '\\,' + parametr : ''}`;
    const selector = `.${className.replace(/,/g, '\\,')}`;
    console.log(selector);
    const $fiszkaToRemove = $(selector);
    if ($fiszkaToRemove.length) {
        console.log('Element znaleziony po opóźnieniu, usuwam...');
        $fiszkaToRemove.remove();
    } else {
        console.log('Element nadal nie znaleziony.');
    }
}
// Dodajemy styl dla zielonego przycisku
$('<style>.green-button { background-color: green; color: white; }</style>').appendTo('head');
// Dodajemy styl dla aktywnego przycisku
$('<style>.active-button { border: 2px solid red; }</style>').appendTo('head');

window.fiszki = fiszki;